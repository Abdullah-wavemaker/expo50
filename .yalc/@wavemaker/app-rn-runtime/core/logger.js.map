{"version":3,"names":["keys","sortBy","logger","StorageService","LoggerCollection","constructor","_defineProperty","Map","init","getItem","key","then","data","config","JSON","parse","forEach","k","_this$loggerMap$get","loggerMap","get","setLevel","level","catch","name","set","setLogLevel","levels","undefined","filter","startsWith","_this$loggerMap$get2","setItem","stringify","getLogLevel","_this$config$name","list","debug","info","warn","error","loggerCollection","log","createLogger","severity","enabledExtensions","Logger","ins","extend","enable","isEnabled","msg","Function","getLogger","ROOT_LOGGER","PERFORMANCE_LOGGER","RENDER_LOGGER","reset"],"sources":["logger.ts"],"sourcesContent":["import { keys, sortBy } from 'lodash-es';\nimport { logger } from 'react-native-logs';\nimport StorageService from './storage.service'\n\nclass LoggerCollection {\n    loggerMap = new Map<string, Logger>();\n    config = {} as any;\n    key = 'wm.log.config';\n\n    init() {\n        StorageService.getItem(this.key).then((data) => {\n            if (data) {\n                this.config = JSON.parse(data as string) || {};\n                keys(this.config).forEach((k: string) => {\n                    this.loggerMap.get(k)?.setLevel(this.config[k].level);\n                });\n            }\n        }).catch(() => {});\n    }\n\n    get(name: string) {\n        return this.loggerMap.get(name);\n    }\n\n    set(name: string, logger: Logger) {\n        this.loggerMap.set(name, logger);\n    }\n\n    setLogLevel(name?: string, level?: string) {\n        if (!level && (name && levels[name] !== undefined)) {\n            level =  name;\n            name = undefined;\n        }\n        if (level !== undefined) {\n            [...this.loggerMap.keys()]\n                .filter(k => !name || k.startsWith(name))\n                .forEach(k => {\n                    level && this.loggerMap.get(k)?.setLevel(level);\n                    if (k) {\n                        this.config[k] =  this.config[k] || {};\n                        this.config[k].level = level;\n                    } \n                });\n                StorageService.setItem(this.key, JSON.stringify(this.config))\n        }\n    }\n\n    getLogLevel(name?: string, level?: string) {\n        return name && this.config[name]?.level;\n    }\n\n    list() {\n        return sortBy([...this.loggerMap.keys()])\n    }\n}\n\nconst levels = {\n    debug: 0,\n    info: 1,\n    warn: 2,\n    error: 3\n} as any;\n\nconst loggerCollection = new LoggerCollection();\n\nconst log = logger.createLogger({\n    severity: 'debug',\n    levels: levels,\n    enabledExtensions: []\n});\n\nexport class Logger {\n\n    private ins = null as any;\n\n    constructor(private name: string, private level: string) {\n        this.ins = log.extend(this.name);\n        log.enable(this.name);\n    }\n\n    private isEnabled(level: string) {\n        return levels[level] >= levels[this.level];\n    }\n\n    private log(level: string, msg: string | Function ) {\n        if (this.isEnabled(level)) {\n            if (msg instanceof Function) {\n                msg = msg();\n            }\n            this.ins[level](msg);\n        }\n    }\n\n    extend(name: string) {\n        return getLogger(this.name + '.' + name);\n    }\n\n    setLevel(level: string) {\n        this.level = level;\n    }\n\n    debug(msg: string | Function) {\n        this.log('debug', msg);\n    }\n\n    info(msg: string | Function) {\n        this.log('info', msg);\n    }\n\n    warn(msg: string | Function) {\n        this.log('warn', msg);\n    }\n\n    error(msg: string | Function) {\n        this.log('error', msg);\n    }\n}\n\nconst getLogger = (name: string, level?: string) => {\n    let logger = loggerCollection.get(name);\n    if (!logger) {\n        logger = new Logger(name, loggerCollection.getLogLevel(name) || 'error');\n        loggerCollection.set(name, logger);\n    }\n    return logger;\n};\n\nexport const ROOT_LOGGER = getLogger('root');\nexport const PERFORMANCE_LOGGER = ROOT_LOGGER.extend('performance');\nexport const RENDER_LOGGER = PERFORMANCE_LOGGER.extend('render');\n\nexport default {\n    get: getLogger,\n    setLogLevel: (name?: string, level?: string) => loggerCollection.setLogLevel(name, level),\n    list: () => loggerCollection.list(),\n    reset: () => loggerCollection.setLogLevel('root', 'error'),\n    init: () => loggerCollection.init()\n};"],"mappings":"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"}