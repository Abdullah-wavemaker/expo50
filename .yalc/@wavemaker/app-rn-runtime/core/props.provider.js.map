{"version":3,"names":["assign","isNil","PropsProvider","constructor","defaultProps","initprops","onChange","arguments","length","undefined","name","$new","$old","_defineProperty","Object","keys","forEach","k","propertyNames","propsProxy","Proxy","get","target","prop","receiver","propName","toString","value","overriddenProps","hasOwnProperty","oldProps","set","has","isDirty","oldValue","setDefault","check","nextProps","result","reduce","b","flag"],"sources":["props.provider.ts"],"sourcesContent":["import { assign, isNil } from \"lodash-es\";\nimport { BaseProps } from \"./base.component\";\n\nexport class PropsProvider<T extends BaseProps> {\n    private oldProps: any = {};\n    private overriddenProps: any = {};\n    private propsProxy: T;\n    private isDirty = false;\n    private propertyNames = {} as any;\n\n    constructor(private defaultProps: T, private initprops: T, private onChange = (name: string, $new: any, $old: any) => {}) {\n        this.initprops = this.initprops || {};\n        Object.keys(defaultProps).forEach(k => this.propertyNames[k] = true);\n        Object.keys(initprops).forEach(k => this.propertyNames[k] = true);\n        //@ts-ignore\n        this.propsProxy = (new Proxy({}, {\n            get: (target, prop, receiver): any => {\n                const propName = prop.toString();\n                let value = (this.defaultProps as any)[propName];\n                if (this.overriddenProps.hasOwnProperty(propName)) {\n                    value = this.overriddenProps[propName];\n                } else if (this.oldProps.hasOwnProperty(propName)) {\n                    value = this.oldProps[propName];\n                }\n                return value;\n            },\n            set: (target: any, prop, value: any): any => {\n                const propName = prop.toString();\n                if (!this.has(propName)) {\n                    return false;\n                }\n                this.isDirty = this.isDirty || this.overriddenProps[propName] !== value;\n                this.overriddenProps[propName] = value;\n                if (this.oldProps[propName] !== value) {\n                    const oldValue = this.oldProps[propName];\n                    this.onChange(propName, value, oldValue);\n                    this.oldProps[propName] = value;\n                }\n                return true;\n            }\n        }));\n    }\n\n    setDefault(propName: string, value: any) {\n        (this.defaultProps as any)[propName] = value;\n    }\n\n    check(nextProps?: T) {\n        if (!nextProps) {\n            nextProps = assign({}, this.defaultProps, this.initprops);\n        }\n        const result = Object.keys(nextProps).reduce((b, k) => {\n            let flag = false;\n            //@ts-ignore\n            const value = nextProps[k];\n            const oldValue = this.oldProps[k];\n            if (isNil(this.overriddenProps[k])\n                && (!this.oldProps.hasOwnProperty(k)\n                    || this.oldProps[k] !== value)) {\n                this.oldProps[k] = value;\n                this.onChange(k, value, oldValue);\n                flag = true;\n            }\n            return b || flag;\n        }, false) || this.isDirty;\n\n      this.isDirty = false;\n      return result;\n    }\n\n    // sets the property. But, value gets overriden when the original prop changes.\n    set(name: string, value: any) {\n        this.oldProps[name] = value;\n        const oldValue = this.oldProps[name];\n        if(oldValue !== value) {\n            this.oldProps[name] = value;\n            this.onChange(name, value, oldValue);\n        }\n    }\n\n    has(propName: string) {\n        return !!this.propertyNames[propName];\n    }\n\n    get() {\n        return this.propsProxy;\n    }\n}\n"],"mappings":"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"}