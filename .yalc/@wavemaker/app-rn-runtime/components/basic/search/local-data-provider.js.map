{"version":3,"names":["filter","includes","values","isNumber","split","toLower","get","toString","isArray","isObject","isString","DataProvider","constructor","_defineProperty","LocalDataProvider","init","self","response","invokeEventCallback","invokeVariable","query","_self$props","paramsObj","props","searchkey","forEach","k","invokeEvent","call","Promise","resolve","config","cb","keys","length","localDataProvider","applyFilter","entry","queryText","entries","filteredData","casesensitive","entryObj","hasOwnProperty","entryKeys","Object","hasEntry","find","item","some","key","a","dataObject","b","join"],"sources":["local-data-provider.ts"],"sourcesContent":["import { filter, includes, values, isNumber, split, toLower, get, toString, isArray, isObject, isString } from 'lodash';\nimport { BaseComponent } from \"@wavemaker/app-rn-runtime/core/base.component\";\n\nexport class DataProvider {\n  private localDataProvider = new LocalDataProvider();\n\n  // check if the variable is of type service variable and whether update is required.\n  init(self: BaseComponent<any, any, any>) {\n    let response = self.invokeEventCallback('isUpdateRequired', []);\n    return response;\n  }\n\n  // setting the inputFields and invoking the variable\n  invokeVariable(self: BaseComponent<any, any, any>, query: string): Promise<any> {\n    let paramsObj: {[key: string] : any} | null = null;\n    self.props?.searchkey && self.props.searchkey.split(',').forEach((k: string) => {\n      if (!paramsObj) {\n        paramsObj = {};\n      }\n      paramsObj[k] = query\n    });\n    let invokeEvent = get(self.props, 'formfield') ? self.props.invokeEvent : self.invokeEventCallback;\n    if (invokeEvent) {\n      return invokeEvent.call(self, 'onQuerySearch', [paramsObj]);\n    }\n    return Promise.resolve();\n  }\n\n  filter(config: any, cb? : () => void | null) {\n    const props = config.props;\n    if (props.searchkey) {\n      const keys = split(props.searchkey, ',');\n      if (keys.length && cb) {\n        cb();\n        return;\n      }\n    }\n    return this.localDataProvider.filter(config);\n  }\n}\n\nexport class LocalDataProvider {\n\n  private applyFilter(entry: any, queryText: any) {\n    entry = isNumber(entry) ? entry.toString() : entry;\n    return includes(entry, queryText);\n  }\n\n  filter(config: any) {\n    const entries = config.entries;\n    let queryText = config.query;\n    const props = config.props;\n    let filteredData;\n    const casesensitive = false;\n\n    /**\n     * If searchkey is defined, then check for match string against each item in the dataset with item's field name as the searchkey\n     * return the filtered data containing the matching string.\n     */\n    if (props.searchkey) {\n      const keys = split(props.searchkey, ',');\n\n      if (!entries.length) {\n        return [];\n      }\n\n      let entryObj = entries[0];\n      entryObj = entryObj.hasOwnProperty('dataObject') ? entryObj['dataObject'] : entryObj;\n      const entryKeys = Object.keys(entryObj);\n      const hasEntry = keys.find(k => {\n        if (k.includes('.')) {\n          k = split(k, '.')[0]\n        }\n        return entryKeys.includes(k)\n      });\n\n      if (!hasEntry) {\n        // widget bound to query variable, searchkey is query or path params and not the key from the entry obj\n        return entries;\n      }\n\n      filteredData = filter(entries, (item: any) => {\n        return keys.some(key => {\n          let a = get(item.dataObject, key),\n            b = queryText;\n          if (!casesensitive) {\n            a = toLower(toString(a));\n            b = toLower(toString(b));\n          }\n          return this.applyFilter(a, b);\n        });\n      });\n    } else {\n      // local search on data with array of objects.\n      // Iterate over each item and return the filtered data containing the matching string.\n      if (isArray(entries) && isObject(entries[0])) {\n        filteredData = filter(entries, (entry: any) => {\n          let a = isString(entry.dataObject) ? entry.dataObject : values(entry.dataObject).join(' ');\n          if (!casesensitive) {\n            a = toLower(a);\n            queryText = toLower(queryText);\n          }\n          return this.applyFilter(a, queryText);\n        });\n      } else {\n        filteredData = filter(entries, (entry: any) => {\n          if (!casesensitive) {\n            entry = toLower(entry);\n            queryText = toLower(queryText);\n          }\n          return this.applyFilter(entry, queryText);\n        });\n      }\n    }\n    return filteredData;\n\n  }\n}\n"],"mappings":";;;AAAA,SAASA,MAAM,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAEC,OAAO,EAAEC,GAAG,EAAEC,QAAQ,EAAEC,OAAO,EAAEC,QAAQ,EAAEC,QAAQ,QAAQ,QAAQ;AAGvH,OAAO,MAAMC,YAAY,CAAC;EAAAC,YAAA;IAAAC,eAAA,4BACI,IAAIC,iBAAiB,CAAC,CAAC;EAAA;EAEnD;EACAC,IAAIA,CAACC,IAAkC,EAAE;IACvC,IAAIC,QAAQ,GAAGD,IAAI,CAACE,mBAAmB,CAAC,kBAAkB,EAAE,EAAE,CAAC;IAC/D,OAAOD,QAAQ;EACjB;;EAEA;EACAE,cAAcA,CAACH,IAAkC,EAAEI,KAAa,EAAgB;IAAA,IAAAC,WAAA;IAC9E,IAAIC,SAAuC,GAAG,IAAI;IAClD,EAAAD,WAAA,GAAAL,IAAI,CAACO,KAAK,cAAAF,WAAA,uBAAVA,WAAA,CAAYG,SAAS,KAAIR,IAAI,CAACO,KAAK,CAACC,SAAS,CAACpB,KAAK,CAAC,GAAG,CAAC,CAACqB,OAAO,CAAEC,CAAS,IAAK;MAC9E,IAAI,CAACJ,SAAS,EAAE;QACdA,SAAS,GAAG,CAAC,CAAC;MAChB;MACAA,SAAS,CAACI,CAAC,CAAC,GAAGN,KAAK;IACtB,CAAC,CAAC;IACF,IAAIO,WAAW,GAAGrB,GAAG,CAACU,IAAI,CAACO,KAAK,EAAE,WAAW,CAAC,GAAGP,IAAI,CAACO,KAAK,CAACI,WAAW,GAAGX,IAAI,CAACE,mBAAmB;IAClG,IAAIS,WAAW,EAAE;MACf,OAAOA,WAAW,CAACC,IAAI,CAACZ,IAAI,EAAE,eAAe,EAAE,CAACM,SAAS,CAAC,CAAC;IAC7D;IACA,OAAOO,OAAO,CAACC,OAAO,CAAC,CAAC;EAC1B;EAEA9B,MAAMA,CAAC+B,MAAW,EAAEC,EAAuB,EAAE;IAC3C,MAAMT,KAAK,GAAGQ,MAAM,CAACR,KAAK;IAC1B,IAAIA,KAAK,CAACC,SAAS,EAAE;MACnB,MAAMS,IAAI,GAAG7B,KAAK,CAACmB,KAAK,CAACC,SAAS,EAAE,GAAG,CAAC;MACxC,IAAIS,IAAI,CAACC,MAAM,IAAIF,EAAE,EAAE;QACrBA,EAAE,CAAC,CAAC;QACJ;MACF;IACF;IACA,OAAO,IAAI,CAACG,iBAAiB,CAACnC,MAAM,CAAC+B,MAAM,CAAC;EAC9C;AACF;AAEA,OAAO,MAAMjB,iBAAiB,CAAC;EAErBsB,WAAWA,CAACC,KAAU,EAAEC,SAAc,EAAE;IAC9CD,KAAK,GAAGlC,QAAQ,CAACkC,KAAK,CAAC,GAAGA,KAAK,CAAC9B,QAAQ,CAAC,CAAC,GAAG8B,KAAK;IAClD,OAAOpC,QAAQ,CAACoC,KAAK,EAAEC,SAAS,CAAC;EACnC;EAEAtC,MAAMA,CAAC+B,MAAW,EAAE;IAClB,MAAMQ,OAAO,GAAGR,MAAM,CAACQ,OAAO;IAC9B,IAAID,SAAS,GAAGP,MAAM,CAACX,KAAK;IAC5B,MAAMG,KAAK,GAAGQ,MAAM,CAACR,KAAK;IAC1B,IAAIiB,YAAY;IAChB,MAAMC,aAAa,GAAG,KAAK;;IAE3B;AACJ;AACA;AACA;IACI,IAAIlB,KAAK,CAACC,SAAS,EAAE;MACnB,MAAMS,IAAI,GAAG7B,KAAK,CAACmB,KAAK,CAACC,SAAS,EAAE,GAAG,CAAC;MAExC,IAAI,CAACe,OAAO,CAACL,MAAM,EAAE;QACnB,OAAO,EAAE;MACX;MAEA,IAAIQ,QAAQ,GAAGH,OAAO,CAAC,CAAC,CAAC;MACzBG,QAAQ,GAAGA,QAAQ,CAACC,cAAc,CAAC,YAAY,CAAC,GAAGD,QAAQ,CAAC,YAAY,CAAC,GAAGA,QAAQ;MACpF,MAAME,SAAS,GAAGC,MAAM,CAACZ,IAAI,CAACS,QAAQ,CAAC;MACvC,MAAMI,QAAQ,GAAGb,IAAI,CAACc,IAAI,CAACrB,CAAC,IAAI;QAC9B,IAAIA,CAAC,CAACzB,QAAQ,CAAC,GAAG,CAAC,EAAE;UACnByB,CAAC,GAAGtB,KAAK,CAACsB,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC,CAAC;QACtB;QACA,OAAOkB,SAAS,CAAC3C,QAAQ,CAACyB,CAAC,CAAC;MAC9B,CAAC,CAAC;MAEF,IAAI,CAACoB,QAAQ,EAAE;QACb;QACA,OAAOP,OAAO;MAChB;MAEAC,YAAY,GAAGxC,MAAM,CAACuC,OAAO,EAAGS,IAAS,IAAK;QAC5C,OAAOf,IAAI,CAACgB,IAAI,CAACC,GAAG,IAAI;UACtB,IAAIC,CAAC,GAAG7C,GAAG,CAAC0C,IAAI,CAACI,UAAU,EAAEF,GAAG,CAAC;YAC/BG,CAAC,GAAGf,SAAS;UACf,IAAI,CAACG,aAAa,EAAE;YAClBU,CAAC,GAAG9C,OAAO,CAACE,QAAQ,CAAC4C,CAAC,CAAC,CAAC;YACxBE,CAAC,GAAGhD,OAAO,CAACE,QAAQ,CAAC8C,CAAC,CAAC,CAAC;UAC1B;UACA,OAAO,IAAI,CAACjB,WAAW,CAACe,CAAC,EAAEE,CAAC,CAAC;QAC/B,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ,CAAC,MAAM;MACL;MACA;MACA,IAAI7C,OAAO,CAAC+B,OAAO,CAAC,IAAI9B,QAAQ,CAAC8B,OAAO,CAAC,CAAC,CAAC,CAAC,EAAE;QAC5CC,YAAY,GAAGxC,MAAM,CAACuC,OAAO,EAAGF,KAAU,IAAK;UAC7C,IAAIc,CAAC,GAAGzC,QAAQ,CAAC2B,KAAK,CAACe,UAAU,CAAC,GAAGf,KAAK,CAACe,UAAU,GAAGlD,MAAM,CAACmC,KAAK,CAACe,UAAU,CAAC,CAACE,IAAI,CAAC,GAAG,CAAC;UAC1F,IAAI,CAACb,aAAa,EAAE;YAClBU,CAAC,GAAG9C,OAAO,CAAC8C,CAAC,CAAC;YACdb,SAAS,GAAGjC,OAAO,CAACiC,SAAS,CAAC;UAChC;UACA,OAAO,IAAI,CAACF,WAAW,CAACe,CAAC,EAAEb,SAAS,CAAC;QACvC,CAAC,CAAC;MACJ,CAAC,MAAM;QACLE,YAAY,GAAGxC,MAAM,CAACuC,OAAO,EAAGF,KAAU,IAAK;UAC7C,IAAI,CAACI,aAAa,EAAE;YAClBJ,KAAK,GAAGhC,OAAO,CAACgC,KAAK,CAAC;YACtBC,SAAS,GAAGjC,OAAO,CAACiC,SAAS,CAAC;UAChC;UACA,OAAO,IAAI,CAACF,WAAW,CAACC,KAAK,EAAEC,SAAS,CAAC;QAC3C,CAAC,CAAC;MACJ;IACF;IACA,OAAOE,YAAY;EAErB;AACF"}