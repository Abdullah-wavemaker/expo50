{"version":3,"names":["React","View","BaseComponent","BaseComponentState","isDefined","debounce","find","forEach","isNil","get","set","cloneDeep","isEmpty","WmLabel","WmIcon","WmMessage","ToastConsumer","WmFormProps","DEFAULT_CLASS","isDataSetWidget","WmFormState","constructor","arguments","_defineProperty","WmForm","props","handleSubmit","componentDidMount","getParentFormRef","parentForm","pformName","current","parent","parentFormRef","setReadonlyFields","_this$formFields","formFields","field","setReadOnlyState","state","isUpdateMode","setReadonlyState","updateMode","updateState","setTimeout","showActions","edit","new","cancel","delete","registerFormFields","formWidgets","w","form","formwidget","formKey","name","f","formfields","applyFormData","applyDefaultValue","formdataoutput","datavalue","dataoutput","_this$buttonArray","buttonArray","action","show","registerFormActions","formActions","_updateFieldOnDataSourceChange","isDataSetBound","widget","isRelated","relatedData","_this$parentFormRef","formData","formdata","formField","_formField$props","fw","key","setState","isDefault","updateFormFieldDefaultValue","dv","defaultvalue","_formField$props2","invokeEventCallback","bind","undefined","formreset","ff","defaultValue","id","_widget","isValid","reset","submit","_debouncedSubmitForm","generateFormFields","userFields","fields","metadata","data","onBeforerender","proxy","dynamicForm","generateComponent","onPropertyChange","$new","$old","_this$formFields2","setPrimaryKey","fieldName","primaryKey","indexOf","push","validateFieldsOnSubmit","val","onValidate","required","msg","defaultValidatorMessages","validationmessage","validate","event","preventDefault","onBeforesubmit","formSubmit","onResultCb","error","response","status","onSuccess","postmessage","toggleMessage","onError","errormessage","updateDataOutput","Object","assign","type","message","messagelayout","showInlineMsg","toaster","showToast","placement","styles","bottom","text","hideOnClick","duration","onMsgClose","renderWidget","createElement","toastService","style","root","_background","iconclass","title","subheading","heading","flex","flexDirection","getTestId","listIcon","caption","hideclose","onClose","children"],"sources":["form.component.tsx"],"sourcesContent":["import React from 'react';\nimport { View } from 'react-native';\nimport { BaseComponent, BaseComponentState } from '@wavemaker/app-rn-runtime/core/base.component';\nimport { isDefined, widgetsWithUndefinedValue } from '@wavemaker/app-rn-runtime/core/utils';\nimport { debounce, find, forEach, isNil, get, set, cloneDeep, isEmpty } from 'lodash';\n\nimport WmLabel from '@wavemaker/app-rn-runtime/components/basic/label/label.component';\nimport WmIcon from '@wavemaker/app-rn-runtime/components/basic/icon/icon.component';\nimport WmFormField, { WmFormFieldState } from '@wavemaker/app-rn-runtime/components/data/form/form-field/form-field.component';\nimport WmMessage from '@wavemaker/app-rn-runtime/components/basic/message/message.component';\nimport { ToastConsumer, ToastService } from '@wavemaker/app-rn-runtime/core/toast.service';\n\nimport WmFormProps from './form.props';\nimport { DEFAULT_CLASS, WmFormStyles } from './form.styles';\nimport WmSkeleton, { createSkeleton } from '../../basic/skeleton/skeleton.component';\nimport { WmSkeletonStyles } from '../../basic/skeleton/skeleton.styles';\nimport { isDataSetWidget } from '@wavemaker/app-rn-runtime/core/utils';\nimport WmFormAction, {\n  WmFormActionState\n} from '@wavemaker/app-rn-runtime/components/data/form/form-action/form-action.component';\n\nexport class WmFormState extends BaseComponentState<WmFormProps> {\n  isValid = false;\n  type: 'success' | 'warning' | 'error' | 'info' | 'loading' | undefined = 'success';\n  message: string = '';\n  showInlineMsg: boolean = false;\n  isUpdateMode: boolean = true;\n  dynamicForm: any;\n}\nexport default class WmForm extends BaseComponent<WmFormProps, WmFormState, WmFormStyles> {\n  public formFields: Array<WmFormField> = []; // contains array of direct widget elements [WmText, WmNumber, WmCurrent]\n  public parentFormRef: any;\n  public formfields: {[key: string]: WmFormField} = {};\n  public formdataoutput: any;\n  private toaster: any;\n  public formActions: Array<WmFormAction> = [];\n  primaryKey = [];\n  buttonArray: Array<WmFormAction> = [];\n  formWidgets: { [key: string]: BaseComponent<any, any, any> } = {}; // object containing key as name of formField and value as WmFormField proxy.\n  constructor(props: WmFormProps) {\n    super(props, DEFAULT_CLASS, new WmFormProps(), new WmFormState());\n  }\n\n  private _debouncedSubmitForm = debounce(this.handleSubmit, 250);\n\n  componentDidMount() {\n    super.componentDidMount();\n    this.getParentFormRef(this.props.parentForm);\n  }\n\n  getParentFormRef(pformName: string) {\n    let current = this.parent;\n    while (current) {\n      if (get(current, 'props.name') === pformName) {\n        this.parentFormRef = current;\n        break;\n      }\n      current = current.parent;\n    }\n  }\n\n  setReadonlyFields() {\n    this.formFields?.forEach((field: any) => {\n      field.setReadOnlyState(this.state.isUpdateMode);\n    });\n  }\n\n  setReadonlyState(updateMode: any) {\n    this.updateState({\n      isUpdateMode: updateMode,\n    } as WmFormState);\n    setTimeout(() => {\n      this.showActions();\n      this.setReadonlyFields();\n    }, 100);\n  }\n\n  edit() {\n    this.setReadonlyState(true);\n  }\n\n  new() {\n    this.setReadonlyState(true);\n  }\n\n  cancel() {\n    this.setReadonlyState(false);\n  }\n\n  delete() { }\n\n  registerFormFields(\n    formFields: Array<WmFormField>,\n    formWidgets: { [key: string]: BaseComponent<any, any, any> }\n  ) {\n    forEach(formFields, (w: WmFormField) => {\n      if (!w.form) {\n        w.form = this;\n        w.formwidget = (w.props.formKey && formWidgets[w.props.formKey])\n          || (w.props.name && formWidgets[w.props.name]);\n      }\n    });\n\n    this.formFields = formFields;\n    this.formWidgets = formWidgets;\n\n    formFields?.forEach((f: WmFormField) => {\n      if (f.props.name) {\n        set(this.formfields, f.props.name, f);\n      }\n    })\n\n    this.setReadonlyFields();\n\n    this.applyFormData();\n    this.applyDefaultValue();\n\n    // setting default form dataoutput.\n    if (!this.formdataoutput) {\n      this.formdataoutput = {};\n      formFields?.forEach((w: WmFormField) => {\n        const name = get(w.props, 'formKey') || w.props.name;\n        if (name) {\n          set(this.formdataoutput, name, w.props.datavalue);\n        }\n      });\n      this.updateState({\n        props: {\n          dataoutput: this.formdataoutput\n        }\n      } as WmFormState);\n    }\n  }\n\n  showActions () {\n    this.buttonArray?.forEach((action: any) => {\n      action.updateState({\n        props: {\n          show: action.updateMode === this.state.isUpdateMode\n        }} as WmFormActionState);\n    });\n  }\n\n  registerFormActions(formActions: Array<WmFormAction>) {\n    this.buttonArray = formActions;\n    this.showActions();\n  }\n\n  private _updateFieldOnDataSourceChange(field: WmFormField, formFields: Array<WmFormField>) {\n    if (!field.state.props.isDataSetBound && isDataSetWidget(field.props.widget)) {\n      if (field.state.props.isRelated) {\n        field.updateState({\n          props: {\n            isDataSetBound: true\n          }} as WmFormFieldState);\n        this.props.relatedData && this.props.relatedData(field);\n      }\n    }\n  }\n\n  applyFormData() {\n    let formData = this.state.props.formdata || this.parentFormRef?.state.props.formdata;\n    if (!formData || (this.parentFormRef && this.state.props.formdata)) {\n      return;\n    }\n    forEach(this.formFields, (formField: WmFormField) => {\n      let fw = formField.props?.name && this.formWidgets[formField.props.name];\n      if (!fw) {\n        fw = find(this.formWidgets, (fw: BaseComponent<any, any, any>) => {\n          return get(fw, 'formfieldname') === formField.props.name\n        });\n      }\n      let key = get(formField, 'formKey') || get(fw, 'props.name');\n      fw && fw.setState({ isDefault: true });\n      formField.updateState({\n        props: {\n          datavalue: get(formData, key)\n        }\n      } as WmFormFieldState);\n    });\n  }\n\n  updateFormFieldDefaultValue(formField: WmFormField) {\n    if (formField) {\n      const dv = formField.state.props.defaultvalue;\n      if (isDefined(dv) && dv !== null && this.formFields) {\n        let field = formField.props?.name && this.formWidgets[formField.props.name];\n        if (!field) {\n          field = find(this.formWidgets, (fw: BaseComponent<any, any, any>) => {\n            return get(fw, 'formfieldname') === formField.props.name\n          });\n        }\n        if (field) {\n          field.setState({ isDefault: true });\n          field.updateState({\n            props: {\n              datavalue: dv\n            }\n          }, this.invokeEventCallback.bind(formField, 'onFieldChange', [undefined, formField, dv]));\n        }\n      }\n    }\n  }\n\n  get dataoutput() {\n    return this.formdataoutput;\n  }\n\n  applyDefaultValue(formField?: WmFormField) {\n    if (formField) {\n      this.updateFormFieldDefaultValue(formField);\n      return;\n    }\n    forEach(this.formFields, (w: WmFormField) => {\n      this.updateFormFieldDefaultValue(w);\n    });\n  }\n\n  formreset() {\n    this.formdataoutput = {};\n    forEach(this.formFields, (ff: WmFormField) => {\n      const defaultValue = isNil(ff.state.props.defaultvalue) ?  '' : ff.state.props.defaultvalue;\n      ff.updateState({\n        props : {\n          datavalue: defaultValue\n        }\n      } as WmFormFieldState, () => {\n          const id = ff.props.formKey || ff.props.name;\n          if (id) {\n            let widget: BaseComponent<any, any, any> | undefined | any = this.formWidgets[id];\n            if (!widget) {\n              widget = find(this.formWidgets, (fw: BaseComponent<any, any, any>) => {\n                return get(fw, 'formfieldname') === ff.props.name\n              });\n            }\n            widget.updateState({\n              isValid: true,\n              props : {\n                datavalue: defaultValue\n              }\n            }, () => ff.updateState({\n              isValid: true\n            } as WmFormFieldState));\n            widget?.reset();\n          }\n        }\n      );\n    });\n  }\n\n  submit() {\n    this._debouncedSubmitForm();\n  }\n\n  // Function to generate and compile the form fields from the metadata\n  generateFormFields() {\n    let userFields;\n    let fields = this.state.props.metadata ? this.state.props.metadata.data || this.state.props.metadata : [];\n\n    if (isEmpty(fields)) {\n      return;\n    }\n\n    if (this.props.onBeforerender) {\n      userFields = this.invokeEventCallback('onBeforerender', [fields,  this.proxy]);\n      if (userFields) {\n        fields = userFields;\n      }\n    }\n\n    this.updateState({\n      dynamicForm:  this.props.generateComponent(fields, this.props.name)\n    } as WmFormState);\n\n  }\n\n  onPropertyChange(name: string, $new: any, $old: any) {\n    switch (name) {\n      case 'formdata':\n        if ($new) {\n          this.applyFormData();\n        }\n        break;\n      case 'defaultmode':\n        this.updateState({\n          isUpdateMode: $new && $new === 'Edit' ? true : false,\n        } as WmFormState);\n        break;\n      case 'dataset':\n        this.formFields?.forEach((w: WmFormField) => {\n          this._updateFieldOnDataSourceChange(w, this.formFields);\n        });\n        break;\n      case 'metadata':\n        this.generateFormFields();\n        break;\n    }\n  }\n  setPrimaryKey(fieldName: string) {\n    /*Store the primary key of data*/\n    this.primaryKey = this.primaryKey || [];\n    // @ts-ignore\n    if (this.primaryKey.indexOf(fieldName) === -1) {\n      // @ts-ignore\n      this.primaryKey.push(fieldName);\n    }\n  }\n  // Disable the form submit if form is in invalid state. Highlight all the invalid fields if validation type is default\n  validateFieldsOnSubmit() {\n    let isValid = true;\n    forEach(this.formFields, (field) => {\n      const val = field?.state.props.datavalue;\n\n      const onValidate = get(field, 'props.onValidate');\n      onValidate && onValidate(field);\n      if (!val && field?.state.props.required) {\n        isValid = false;\n        const msg = get(field.defaultValidatorMessages, 'required') || field.state.props.validationmessage;\n        field.updateState({ isValid: isValid, props: {\n            validationmessage: msg\n          }} as WmFormFieldState);\n        field.formwidget.validate && field.formwidget.validate(val);\n      }\n      // check for isvalid state of formwidget\n      if (field.formwidget.state.isValid === false) {\n        isValid = false;\n      }\n    });\n    return isValid;\n  }\n\n  // @ts-ignore\n  handleSubmit(event?: any) {\n    event?.preventDefault();\n    const formData = cloneDeep(this.state.props.dataoutput || this.formdataoutput);\n\n    if (!this.validateFieldsOnSubmit()) {\n      return false;\n    }\n    if (this.props.onBeforesubmit) {\n      this.invokeEventCallback('onBeforesubmit', [ null, this.proxy, formData ]);\n    }\n    if (this.props.formSubmit) {\n      this.props.formSubmit(formData, ((data: any) => {\n        this.invokeEventCallback('onSubmit', [ null, this.proxy, formData ]);\n        this.onResultCb(get(data, 'params'), 'success');\n      }), ((error: any) => {\n        this.invokeEventCallback('onSubmit', [ null, this.proxy, formData ]);\n        this.onResultCb(error, '');\n      }));\n    } else {\n      this.invokeEventCallback('onSubmit', [ null, this.proxy, formData ]);\n    }\n  }\n\n  onResultCb(response: any, status: string, event?: any) {\n    this.invokeEventCallback('onResult', [ null, this.proxy, response ]);\n    if (status) {\n      this.invokeEventCallback('onSuccess', [ null, this.proxy, response ]);\n      !this.props.onSuccess && this.state.props.postmessage && this.toggleMessage('success', this.state.props.postmessage);\n    } else {\n      this.invokeEventCallback('onError', [ null, this.proxy, response ]);\n      !this.props.onError && this.toggleMessage('error', this.state.props.errormessage || get(response, 'message'));\n    }\n  }\n\n  updateDataOutput(key: string, val: any) {\n    const current = this.formdataoutput || {};\n    if (key) {\n      set(current, key, val);\n    } else {\n      Object.assign(current, val)\n    }\n    this.formdataoutput = current;\n    this.updateState({ props: { dataoutput: current }} as WmFormState);\n    this.parentFormRef && this.parentFormRef.updateDataOutput(undefined, this.formdataoutput);\n    this.updateState({\n      props: {\n        dataoutput: this.formdataoutput\n      }\n    } as WmFormState);\n  }\n\n  toggleMessage(\n    type: 'success' | 'warning' | 'error' | 'info' | 'loading' | undefined,\n    message: string\n  ) {\n    if (this.state.props.messagelayout === 'Inline') {\n        this.setState({\n          type: type,\n          message: message,\n          showInlineMsg: true\n        } as WmFormState)\n      return;\n    }\n    this.toaster.showToast({\n      name: this, placement: \"\", styles: {bottom: 0},\n      text: message,\n      type: type,\n      hideOnClick: true,\n      duration: 5000\n    });\n  }\n\n  onMsgClose() {\n    this.setState({\n      showInlineMsg: false\n    } as WmFormState)\n  }\n\n  renderWidget(props: WmFormProps) {\n    return (\n      <ToastConsumer>\n        {(toastService: ToastService) => {\n          this.toaster = toastService;\n          return <View style={this.styles.root}>\n            {this._background}\n            {props.iconclass || props.title || props.subheading ? (\n              <View style={this.styles.heading}>\n                <View style={{flex: 1, flexDirection: 'row'}}>\n                  <WmIcon  id={this.getTestId('icon')} styles={this.styles.listIcon} iconclass={props.iconclass}></WmIcon>\n                  <View>\n                    <WmLabel id={this.getTestId('title')} styles={this.styles.title} caption={props.title}></WmLabel>\n                    <WmLabel id={this.getTestId('description')} styles={this.styles.subheading} caption={props.subheading}></WmLabel>\n                  </View>\n                </View>\n              </View>\n            ) : null}\n            {this.state.showInlineMsg ? <WmMessage type={this.state.type} caption={this.state.message} hideclose={false} onClose={this.onMsgClose.bind(this)}></WmMessage> : null\n            }\n            { props.metadata && this.state.dynamicForm }\n            { props.children}\n          </View>\n        }\n        }\n      </ToastConsumer>\n    );\n  }\n}\n"],"mappings":"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"}