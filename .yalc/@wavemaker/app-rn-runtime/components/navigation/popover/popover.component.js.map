{"version":3,"names":["React","isString","TouchableOpacity","Text","View","ScrollView","Dimensions","BaseComponent","BaseComponentState","ModalConsumer","WmAnchor","WmPopoverProps","DEFAULT_CLASS","WmContainer","AccessibilityWidgetType","getAccessibilityProps","WmPopoverState","constructor","arguments","_defineProperty","WmPopover","props","e","position","state","type","windowDimensions","get","view","measure","x","y","width","height","px","py","popoverwidth","parseInt","left","top","updateState","setState","isOpened","invokeEventCallback","stopPropagation","prepareModalOptions","content","styles","modalService","o","modalOptions","modalStyle","modal","contentStyle","modalContent","isModal","autoclose","centered","animation","contentanimation","onClose","hide","isPartialLoaded","hideModal","renderWidget","dimensions","theme","mergeStyle","getStyle","popoverheight","createElement","_extends","style","root","onLayout","computePosition","ref","POVOVER","_background","id","getTestId","caption","badgevalue","iconclass","iconposition","iconheight","iconwidth","iconmargin","iconurl","link","onTap","showPopover","showModal","popover","onScroll","event","notify","scrollEventThrottle","accessible","accessibilityViewIsModal","title","getTestPropsForAction","activeOpacity","onPress","popoverContent","onLoad","renderPartial","p","children"],"sources":["popover.component.tsx"],"sourcesContent":["import React from 'react';\nimport { isString } from 'lodash-es';\nimport { LayoutChangeEvent, TouchableOpacity, Text, View, ScrollView, Dimensions } from 'react-native';\nimport { BaseComponent, BaseComponentState, BaseProps } from '@wavemaker/app-rn-runtime/core/base.component';\n\nimport { SyntheticEvent } from '@wavemaker/app-rn-runtime/core/tappable.component';\nimport { ModalConsumer, ModalOptions, ModalService } from '@wavemaker/app-rn-runtime/core/modal.service';\nimport WmAnchor from '@wavemaker/app-rn-runtime/components/basic/anchor/anchor.component';\n\nimport WmPopoverProps from './popover.props';\nimport { DEFAULT_CLASS, WmPopoverStyles } from './popover.styles';\nimport WmContainer from '../../container/container.component';\nimport { AccessibilityWidgetType, getAccessibilityProps } from '@wavemaker/app-rn-runtime/core/accessibility'; \n\nexport class WmPopoverState extends BaseComponentState<WmPopoverProps> {\n  isOpened: boolean = false;\n  modalOptions = {} as ModalOptions;\n  position = {} as PopoverPosition;\n  isPartialLoaded = false;\n}\n\nexport interface PopoverPosition {\n  top?: number;\n  bottom?: number;\n  left?: number;\n  right?: number;\n}\n\nexport default class WmPopover extends BaseComponent<WmPopoverProps, WmPopoverState, WmPopoverStyles> {\n\n  view: View = null as any;\n\n  constructor(props: WmPopoverProps) {\n    super(props, DEFAULT_CLASS, new WmPopoverProps(), new WmPopoverState());\n  }\n\n  private computePosition = (e: LayoutChangeEvent) => {\n    const position = {} as PopoverPosition;\n    if (this.state.props.type === 'dropdown') {\n      const windowDimensions = Dimensions.get('window');\n      this.view.measure((x, y, width, height, px, py) => {\n        let popoverwidth = this.state.props.popoverwidth as any;\n        if (popoverwidth && isString(popoverwidth)) {\n          popoverwidth = parseInt(popoverwidth);\n        }\n        position.left = px;\n        if (px + popoverwidth > windowDimensions.width) {\n          position.left = px + width - popoverwidth;\n        }\n        position.top = py + height;\n        this.updateState({position: position} as WmPopoverState);\n      });\n    }\n  };\n\n  public showPopover = (e?: SyntheticEvent) => {\n    this.setState({ isOpened: true });\n    this.invokeEventCallback('onShow', [e, this]);\n    e?.stopPropagation();\n  };\n\n  public hide = () => {};\n\n  prepareModalOptions(content: React.ReactNode, styles: WmPopoverStyles, modalService: ModalService) {\n    const o = this.state.modalOptions;\n    o.modalStyle = styles.modal;\n    o.contentStyle = {...styles.modalContent, ...this.state.position};\n    o.content = content;\n    o.isModal = this.state.props.autoclose !== 'disabled';\n    o.centered = true;\n    o.animation = this.state.props.contentanimation || 'slideInUp';\n    o.onClose = () => {\n      this.hide = () => {};\n      this.setState({ isOpened: false, isPartialLoaded: false, modalOptions: {} as ModalOptions });\n      this.invokeEventCallback('onHide', [null, this]);\n    };\n    this.hide = () => modalService.hideModal(this.state.modalOptions);\n    return o;\n  }\n\n  renderWidget(props: WmPopoverProps) {\n    let dimensions = {} as any;\n    const styles = this.theme.mergeStyle(this.theme.getStyle('popover-' + props.type), this.styles);\n    if (props.type === 'dropdown') {\n      if (props.popoverwidth) {\n        dimensions.width = props.popoverwidth;\n        styles.modalContent.width = props.popoverwidth;\n      }\n      if (props.popoverheight) {\n        dimensions.height = props.popoverheight;\n      }\n    }\n    return (\n      <View style={styles.root} onLayout={this.computePosition} ref={ref => {this.view = ref as View}} {...getAccessibilityProps(AccessibilityWidgetType.POVOVER, props)}>\n        {this._background}\n        <WmAnchor\n          id={this.getTestId('trigger')}\n          animation={props.animation}\n          caption={props.caption}\n          badgevalue={props.badgevalue}\n          iconclass={props.iconclass}\n          iconposition={props.iconposition}\n          iconheight={props.iconheight}\n          iconwidth={props.iconwidth}\n          iconmargin={props.iconmargin}\n          iconurl={props.iconurl}\n          styles={styles.link}\n          onTap={this.showPopover}/>\n        {this.state.isOpened ? (\n          <ModalConsumer>\n            {(modalService: ModalService) => {\n              modalService.showModal(this.prepareModalOptions((\n                  <ScrollView style={this.theme.mergeStyle(styles.popover, dimensions)} \n                    onScroll={(event) => {this.notify('scroll', [event])}}\n                    scrollEventThrottle={48}\n                    accessible={props.type !== \"dropdown\"} accessibilityViewIsModal>\n                    {props.title ? (<Text style={styles.title}>{props.title}</Text>): null}\n                    <TouchableOpacity \n                    {...this.getTestPropsForAction('outercontent')}\n                    activeOpacity={1} onPress={() => {\n                      props.autoclose === 'always' && this.hide()\n                    }} style={styles.popoverContent.root}>\n                      <WmContainer\n                        styles={styles.popoverContent}\n                        onLoad={() => this.invokeEventCallback('onLoad', [this])}\n                        {... props.renderPartial ? {\n                          renderPartial : (p: any, onLoad: Function) => {\n                            return props.renderPartial && props.renderPartial(props, onLoad);\n                          }\n                        } : {}}>\n                          {props.renderPartial ? null : props.children}\n                      </WmContainer>\n                    </TouchableOpacity>\n                  </ScrollView>\n              ), styles, modalService));\n              return null;\n            }}\n          </ModalConsumer>) : null}\n      </View>);\n  }\n}\n"],"mappings":";;;;AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,QAAQ,WAAW;AACpC,SAA4BC,gBAAgB,EAAEC,IAAI,EAAEC,IAAI,EAAEC,UAAU,EAAEC,UAAU,QAAQ,cAAc;AACtG,SAASC,aAAa,EAAEC,kBAAkB,QAAmB,+CAA+C;AAG5G,SAASC,aAAa,QAAoC,8CAA8C;AACxG,OAAOC,QAAQ,MAAM,oEAAoE;AAEzF,OAAOC,cAAc,MAAM,iBAAiB;AAC5C,SAASC,aAAa,QAAyB,kBAAkB;AACjE,OAAOC,WAAW,MAAM,qCAAqC;AAC7D,SAASC,uBAAuB,EAAEC,qBAAqB,QAAQ,8CAA8C;AAE7G,OAAO,MAAMC,cAAc,SAASR,kBAAkB,CAAiB;EAAAS,YAAA;IAAA,SAAAC,SAAA;IAAAC,eAAA,mBACjD,KAAK;IAAAA,eAAA,uBACV,CAAC,CAAC;IAAAA,eAAA,mBACN,CAAC,CAAC;IAAAA,eAAA,0BACK,KAAK;EAAA;AACzB;AASA,eAAe,MAAMC,SAAS,SAASb,aAAa,CAAkD;EAIpGU,WAAWA,CAACI,KAAqB,EAAE;IACjC,KAAK,CAACA,KAAK,EAAET,aAAa,EAAE,IAAID,cAAc,CAAC,CAAC,EAAE,IAAIK,cAAc,CAAC,CAAC,CAAC;IAACG,eAAA,eAH7D,IAAI;IAAAA,eAAA,0BAMUG,CAAoB,IAAK;MAClD,MAAMC,QAAQ,GAAG,CAAC,CAAoB;MACtC,IAAI,IAAI,CAACC,KAAK,CAACH,KAAK,CAACI,IAAI,KAAK,UAAU,EAAE;QACxC,MAAMC,gBAAgB,GAAGpB,UAAU,CAACqB,GAAG,CAAC,QAAQ,CAAC;QACjD,IAAI,CAACC,IAAI,CAACC,OAAO,CAAC,CAACC,CAAC,EAAEC,CAAC,EAAEC,KAAK,EAAEC,MAAM,EAAEC,EAAE,EAAEC,EAAE,KAAK;UACjD,IAAIC,YAAY,GAAG,IAAI,CAACZ,KAAK,CAACH,KAAK,CAACe,YAAmB;UACvD,IAAIA,YAAY,IAAInC,QAAQ,CAACmC,YAAY,CAAC,EAAE;YAC1CA,YAAY,GAAGC,QAAQ,CAACD,YAAY,CAAC;UACvC;UACAb,QAAQ,CAACe,IAAI,GAAGJ,EAAE;UAClB,IAAIA,EAAE,GAAGE,YAAY,GAAGV,gBAAgB,CAACM,KAAK,EAAE;YAC9CT,QAAQ,CAACe,IAAI,GAAGJ,EAAE,GAAGF,KAAK,GAAGI,YAAY;UAC3C;UACAb,QAAQ,CAACgB,GAAG,GAAGJ,EAAE,GAAGF,MAAM;UAC1B,IAAI,CAACO,WAAW,CAAC;YAACjB,QAAQ,EAAEA;UAAQ,CAAmB,CAAC;QAC1D,CAAC,CAAC;MACJ;IACF,CAAC;IAAAJ,eAAA,sBAEqBG,CAAkB,IAAK;MAC3C,IAAI,CAACmB,QAAQ,CAAC;QAAEC,QAAQ,EAAE;MAAK,CAAC,CAAC;MACjC,IAAI,CAACC,mBAAmB,CAAC,QAAQ,EAAE,CAACrB,CAAC,EAAE,IAAI,CAAC,CAAC;MAC7CA,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEsB,eAAe,CAAC,CAAC;IACtB,CAAC;IAAAzB,eAAA,eAEa,MAAM,CAAC,CAAC;EA3BtB;EA6BA0B,mBAAmBA,CAACC,OAAwB,EAAEC,MAAuB,EAAEC,YAA0B,EAAE;IACjG,MAAMC,CAAC,GAAG,IAAI,CAACzB,KAAK,CAAC0B,YAAY;IACjCD,CAAC,CAACE,UAAU,GAAGJ,MAAM,CAACK,KAAK;IAC3BH,CAAC,CAACI,YAAY,GAAG;MAAC,GAAGN,MAAM,CAACO,YAAY;MAAE,GAAG,IAAI,CAAC9B,KAAK,CAACD;IAAQ,CAAC;IACjE0B,CAAC,CAACH,OAAO,GAAGA,OAAO;IACnBG,CAAC,CAACM,OAAO,GAAG,IAAI,CAAC/B,KAAK,CAACH,KAAK,CAACmC,SAAS,KAAK,UAAU;IACrDP,CAAC,CAACQ,QAAQ,GAAG,IAAI;IACjBR,CAAC,CAACS,SAAS,GAAG,IAAI,CAAClC,KAAK,CAACH,KAAK,CAACsC,gBAAgB,IAAI,WAAW;IAC9DV,CAAC,CAACW,OAAO,GAAG,MAAM;MAChB,IAAI,CAACC,IAAI,GAAG,MAAM,CAAC,CAAC;MACpB,IAAI,CAACpB,QAAQ,CAAC;QAAEC,QAAQ,EAAE,KAAK;QAAEoB,eAAe,EAAE,KAAK;QAAEZ,YAAY,EAAE,CAAC;MAAkB,CAAC,CAAC;MAC5F,IAAI,CAACP,mBAAmB,CAAC,QAAQ,EAAE,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IAClD,CAAC;IACD,IAAI,CAACkB,IAAI,GAAG,MAAMb,YAAY,CAACe,SAAS,CAAC,IAAI,CAACvC,KAAK,CAAC0B,YAAY,CAAC;IACjE,OAAOD,CAAC;EACV;EAEAe,YAAYA,CAAC3C,KAAqB,EAAE;IAClC,IAAI4C,UAAU,GAAG,CAAC,CAAQ;IAC1B,MAAMlB,MAAM,GAAG,IAAI,CAACmB,KAAK,CAACC,UAAU,CAAC,IAAI,CAACD,KAAK,CAACE,QAAQ,CAAC,UAAU,GAAG/C,KAAK,CAACI,IAAI,CAAC,EAAE,IAAI,CAACsB,MAAM,CAAC;IAC/F,IAAI1B,KAAK,CAACI,IAAI,KAAK,UAAU,EAAE;MAC7B,IAAIJ,KAAK,CAACe,YAAY,EAAE;QACtB6B,UAAU,CAACjC,KAAK,GAAGX,KAAK,CAACe,YAAY;QACrCW,MAAM,CAACO,YAAY,CAACtB,KAAK,GAAGX,KAAK,CAACe,YAAY;MAChD;MACA,IAAIf,KAAK,CAACgD,aAAa,EAAE;QACvBJ,UAAU,CAAChC,MAAM,GAAGZ,KAAK,CAACgD,aAAa;MACzC;IACF;IACA,oBACErE,KAAA,CAAAsE,aAAA,CAAClE,IAAI,EAAAmE,QAAA;MAACC,KAAK,EAAEzB,MAAM,CAAC0B,IAAK;MAACC,QAAQ,EAAE,IAAI,CAACC,eAAgB;MAACC,GAAG,EAAEA,GAAG,IAAI;QAAC,IAAI,CAAChD,IAAI,GAAGgD,GAAW;MAAA;IAAE,GAAK7D,qBAAqB,CAACD,uBAAuB,CAAC+D,OAAO,EAAExD,KAAK,CAAC,GAC/J,IAAI,CAACyD,WAAW,eACjB9E,KAAA,CAAAsE,aAAA,CAAC5D,QAAQ;MACPqE,EAAE,EAAE,IAAI,CAACC,SAAS,CAAC,SAAS,CAAE;MAC9BtB,SAAS,EAAErC,KAAK,CAACqC,SAAU;MAC3BuB,OAAO,EAAE5D,KAAK,CAAC4D,OAAQ;MACvBC,UAAU,EAAE7D,KAAK,CAAC6D,UAAW;MAC7BC,SAAS,EAAE9D,KAAK,CAAC8D,SAAU;MAC3BC,YAAY,EAAE/D,KAAK,CAAC+D,YAAa;MACjCC,UAAU,EAAEhE,KAAK,CAACgE,UAAW;MAC7BC,SAAS,EAAEjE,KAAK,CAACiE,SAAU;MAC3BC,UAAU,EAAElE,KAAK,CAACkE,UAAW;MAC7BC,OAAO,EAAEnE,KAAK,CAACmE,OAAQ;MACvBzC,MAAM,EAAEA,MAAM,CAAC0C,IAAK;MACpBC,KAAK,EAAE,IAAI,CAACC;IAAY,CAAC,CAAC,EAC3B,IAAI,CAACnE,KAAK,CAACkB,QAAQ,gBAClB1C,KAAA,CAAAsE,aAAA,CAAC7D,aAAa,QACVuC,YAA0B,IAAK;MAC/BA,YAAY,CAAC4C,SAAS,CAAC,IAAI,CAAC/C,mBAAmB,eAC3C7C,KAAA,CAAAsE,aAAA,CAACjE,UAAU;QAACmE,KAAK,EAAE,IAAI,CAACN,KAAK,CAACC,UAAU,CAACpB,MAAM,CAAC8C,OAAO,EAAE5B,UAAU,CAAE;QACnE6B,QAAQ,EAAGC,KAAK,IAAK;UAAC,IAAI,CAACC,MAAM,CAAC,QAAQ,EAAE,CAACD,KAAK,CAAC,CAAC;QAAA,CAAE;QACtDE,mBAAmB,EAAE,EAAG;QACxBC,UAAU,EAAE7E,KAAK,CAACI,IAAI,KAAK,UAAW;QAAC0E,wBAAwB;MAAA,GAC9D9E,KAAK,CAAC+E,KAAK,gBAAIpG,KAAA,CAAAsE,aAAA,CAACnE,IAAI;QAACqE,KAAK,EAAEzB,MAAM,CAACqD;MAAM,GAAE/E,KAAK,CAAC+E,KAAY,CAAC,GAAG,IAAI,eACtEpG,KAAA,CAAAsE,aAAA,CAACpE,gBAAgB,EAAAqE,QAAA,KACb,IAAI,CAAC8B,qBAAqB,CAAC,cAAc,CAAC;QAC9CC,aAAa,EAAE,CAAE;QAACC,OAAO,EAAEA,CAAA,KAAM;UAC/BlF,KAAK,CAACmC,SAAS,KAAK,QAAQ,IAAI,IAAI,CAACK,IAAI,CAAC,CAAC;QAC7C,CAAE;QAACW,KAAK,EAAEzB,MAAM,CAACyD,cAAc,CAAC/B;MAAK,iBACnCzE,KAAA,CAAAsE,aAAA,CAACzD,WAAW,EAAA0D,QAAA;QACVxB,MAAM,EAAEA,MAAM,CAACyD,cAAe;QAC9BC,MAAM,EAAEA,CAAA,KAAM,IAAI,CAAC9D,mBAAmB,CAAC,QAAQ,EAAE,CAAC,IAAI,CAAC;MAAE,GACpDtB,KAAK,CAACqF,aAAa,GAAG;QACzBA,aAAa,EAAGA,CAACC,CAAM,EAAEF,MAAgB,KAAK;UAC5C,OAAOpF,KAAK,CAACqF,aAAa,IAAIrF,KAAK,CAACqF,aAAa,CAACrF,KAAK,EAAEoF,MAAM,CAAC;QAClE;MACF,CAAC,GAAG,CAAC,CAAC,GACHpF,KAAK,CAACqF,aAAa,GAAG,IAAI,GAAGrF,KAAK,CAACuF,QAC3B,CACG,CACR,CAAC,EACd7D,MAAM,EAAEC,YAAY,CAAC,CAAC;MACzB,OAAO,IAAI;IACb,CACa,CAAC,GAAI,IAClB,CAAC;EACX;AACF"}