{"version":3,"names":["React","View","Text","BaseComponent","BaseComponentState","WmIcon","WmRatingProps","DEFAULT_CLASS","cloneDeep","isArray","isNumber","isString","WmRatingState","constructor","arguments","_defineProperty","WmRating","props","caption","state","prepareItems","items","dataset","maxvalue","Array","from","keys","map","v","split","Object","i","key","value","selectedIndex","datavalue","undefined","findIndex","item","k","datafield","showcaptions","selectedItem","getDisplayExpression","displayfield","updateState","onPropertyChange","name","$new","$old","isDefault","onFieldChange","bind","disabled","changeValue","oldValue","readonly","invokeEventCallback","proxy","renderWidget","maxValue","arr","selectedIconStyles","styles","selectedIcon","iconcolor","text","color","createElement","style","root","_background","id","getTestId","iconclass","iconsize","onTap","icon"],"sources":["rating.component.tsx"],"sourcesContent":["import React from 'react';\nimport { View, Text } from 'react-native';\nimport { BaseComponent, BaseComponentState } from '@wavemaker/app-rn-runtime/core/base.component';\nimport WmIcon from '@wavemaker/app-rn-runtime/components/basic/icon/icon.component';\n\nimport WmRatingProps from './rating.props';\nimport { DEFAULT_CLASS, WmRatingStyles } from './rating.styles';\nimport { cloneDeep, isArray, isEmpty, isNumber, isString } from 'lodash-es';\n\nexport class WmRatingState extends BaseComponentState<WmRatingProps> {\n  items: any[] = null as any;\n  caption: any = null as any;\n  selectedIndex = -1;\n  isDefault = false;\n}\n\nexport default class WmRating extends BaseComponent<WmRatingProps, WmRatingState, WmRatingStyles> {\n\n  constructor(props: WmRatingProps) {\n    super(props, DEFAULT_CLASS, new WmRatingProps());\n  }\n\n  get caption() {\n    return this.state.caption;\n  }\n\n  prepareItems(props: WmRatingProps) {\n    let items: any[] = [];\n    if (!props.dataset && props.maxvalue) {\n      items = Array.from(Array(+props.maxvalue).keys());\n      items = items.map(v => v + 1);\n    } else if (isString(props.dataset)) {\n      items = props.dataset.split(',');\n    } else {\n      items = props.dataset as any[] || [];\n    }\n    if (isArray(items) && items[0] !== Object(items[0])) {\n      items = items.map((v, i) => ({\n        key: i + 1,\n        value: v\n      }));\n    }\n    let selectedIndex = -1;\n    if (props.datavalue !== undefined && props.datavalue !== null) {\n      selectedIndex = items.findIndex((item: any, k) => item[props.datafield as string] == props.datavalue);\n      if (selectedIndex === -1 && isNumber(props.datavalue)) {\n        selectedIndex = props.datavalue;\n      }\n    }\n    let caption: any = '';\n    if (selectedIndex > -1 && props.showcaptions) {\n      const selectedItem = items[selectedIndex];\n      if (selectedItem) {\n        if (props.getDisplayExpression) {\n          caption = props.getDisplayExpression(selectedItem);\n        } else {\n          caption = selectedItem[props.displayfield as string];\n        }\n      } else {\n        caption = selectedIndex + 1;\n      }\n    }\n    this.updateState({\n      items: items,\n      selectedIndex: selectedIndex,\n      caption: caption\n    } as WmRatingState);\n  }\n\n  onPropertyChange(name: string, $new: any, $old: any) {\n    switch(name) {\n      case 'dataset' :\n      case 'datafield' :\n      case 'displayfield' :\n      case 'maxvalue':\n      case 'datavalue' :\n        this.prepareItems(this.state.props);\n        if (name === 'datavalue') {\n          const isDefault = this.state.isDefault;\n          if (isDefault) {\n            this.updateState({ isDefault: false } as WmRatingState, this.props.onFieldChange && this.props.onFieldChange.bind(this, 'datavalue', $new, $old, isDefault));\n          } else {\n            this.props.onFieldChange && this.props.onFieldChange('datavalue', $new, $old, isDefault);\n          }\n        }\n        break;\n      case 'readonly' :\n        this.updateState({\n          props: {\n            disabled: $new\n          }\n        } as WmRatingState);\n        break;\n    }\n  }\n\n  changeValue(i: number) {\n    const props = this.state.props;\n    const oldValue = props.datavalue;\n    if (!props.readonly) {\n      let value = this.state.items[i] ? this.state.items[i][props.datafield || '']: i;\n      this.updateState({\n        props: {\n          datavalue:  value\n        }\n      } as WmRatingState, () => {\n        !this.props.onFieldChange && value !== oldValue && this.invokeEventCallback('onChange', [undefined, this.proxy, value, oldValue]);\n      });\n    }\n  }\n\n  renderWidget(props: WmRatingProps) {\n    const maxValue = props.maxvalue ? +props.maxvalue : 5;\n    const arr = Array.from(Array(maxValue).keys());\n\n    let selectedIconStyles = this.styles.selectedIcon;\n    if (props.iconcolor) {\n      selectedIconStyles = cloneDeep(this.styles.selectedIcon);\n      selectedIconStyles.text.color = props.iconcolor;\n    }\n    return (\n    <View style={this.styles.root}>\n      {this._background}\n      {arr.map((v, i) => (\n        (this.state.selectedIndex > -1 && i <= this.state.selectedIndex) ? <WmIcon\n          id={this.getTestId('star' + i)}\n          key={i}\n          iconclass=\"wi wi-star\"\n          iconsize={props.iconsize}\n          styles={selectedIconStyles}\n          onTap={() => { this.changeValue(i)}}\n        ></WmIcon> : null\n      ))}\n      {arr.map((v, i) => (\n        (this.state.selectedIndex === -1 || i > this.state.selectedIndex) ? <WmIcon\n          id={this.getTestId('star' + i)}\n          key={i}\n          iconclass=\"wi wi-star-border\"\n          iconsize={props.iconsize}\n          styles={this.styles.icon}\n          onTap={() => { this.changeValue(i)}}\n        ></WmIcon> : null\n      ))}\n      { !!props.showcaptions ? (<Text style={this.styles.text}>{this.state.caption}</Text>) : null }\n    </View>);\n  }\n}\n"],"mappings":"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"}