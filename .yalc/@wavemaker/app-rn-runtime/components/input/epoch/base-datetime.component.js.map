{"version":3,"names":["React","View","Text","Platform","TouchableOpacity","moment","DateTimePicker","BaseComponent","BaseComponentState","WmIcon","WmDatetimeProps","DEFAULT_CLASS","WebDatePicker","isNumber","isString","ModalConsumer","validateField","AccessibilityWidgetType","getAccessibilityProps","FloatingLabel","AppI18nService","WmButton","BaseDatetimeState","constructor","arguments","_defineProperty","CURRENT_DATE","CURRENT_TIME","BaseDatetime","props","defaultClass","length","undefined","defaultProps","defaultState","format","date","Date","getTime","parse","parseInt","toDate","monitorAndUpdateCurrentTime","stopCurrentTimeMonitor","timerId","setInterval","updateState","readonly","datavalue","now","state","clearInterval","convertTimezone","timezone","getTimezone","parsedDateString","toLocaleString","locale","timeZone","onPropertyChange","name","$new","$old","invokeEventCallback","prevDatavalue","outputformat","datepattern","dateValue","displayValue","onFieldChange","minDateVal","mindate","maxDateVal","maxdate","disabled","onDateChange","$event","validate","modes","shift","isFocused","showDatePicker","timestamp","onBlur","OS","setTimeout","triggerValidation","onFocus","mode","value","validationObj","setState","isValid","errorType","componentWillUnmount","renderWebWidget","createElement","onDismiss","minimumDate","maximumDate","renderNativeWidget","_extends","DATE","is24Hour","display","onChange","event","dateSelected","set","getMonth","getFullYear","getDate","renderNativeIOSWidget","date_change","style","styles","dialog","actionWrapper","selectBtn","caption","onTap","cancelBtn","renderNativeIOSWidgetWithModal","modalService","nativeModalOptions","content","Fragment","hideModal","centered","onClose","showModal","renderNativeWidgetWithModal","addTouchableOpacity","children","getTestPropsForAction","onPress","getIcon","renderWidget","root","invalid","focused","_background","floatinglabel","moveUp","label","placeholder","floatingLabel","activeFloatingLabel","container","text","placeholderText","getTestPropsForLabel","flex","isRTL","flexDirection","textAlign","iconclass","color","clearIcon","id","getTestId","clearBtnClicked","calendarIcon"],"sources":["base-datetime.component.tsx"],"sourcesContent":["import React from 'react';\nimport { View, Text, Platform, TouchableOpacity, ViewStyle } from 'react-native';\nimport moment from 'moment';\nimport DateTimePicker, { DateTimePickerEvent } from '@react-native-community/datetimepicker';\nimport { BaseComponent, BaseComponentState } from '@wavemaker/app-rn-runtime/core/base.component';\nimport WmIcon from '@wavemaker/app-rn-runtime/components/basic/icon/icon.component';\n\nimport WmDatetimeProps from './datetime/datetime.props';\nimport { DEFAULT_CLASS, WmDatetimeStyles } from './datetime/datetime.styles';\nimport WebDatePicker from './date-picker.component';\nimport { isNumber, isString } from 'lodash-es';\nimport { ModalConsumer, ModalOptions, ModalService } from '@wavemaker/app-rn-runtime/core/modal.service';\nimport { validateField } from '@wavemaker/app-rn-runtime/core/utils';\nimport { AccessibilityWidgetType, getAccessibilityProps } from '@wavemaker/app-rn-runtime/core/accessibility'; \nimport { FloatingLabel } from '@wavemaker/app-rn-runtime/core/components/floatinglabel.component';\nimport AppI18nService from '@wavemaker/app-rn-runtime/runtime/services/app-i18n.service';\nimport WmButton from '@wavemaker/app-rn-runtime/components/basic/button/button.component';\n\nexport class BaseDatetimeState extends BaseComponentState<WmDatetimeProps> {\n  showDatePicker = false;\n  dateValue: Date =  null as any;\n  displayValue: string = null as any;\n  isFocused = false;\n  timerId: NodeJS.Timer = null as any;\n  isValid: boolean = true;\n  errorType = '';\n}\n\nconst CURRENT_DATE = 'CURRENT_DATE';\nconst CURRENT_TIME = 'CURRENT_TIME';\n\nexport default abstract class BaseDatetime extends BaseComponent<WmDatetimeProps, BaseDatetimeState, WmDatetimeStyles> {\n  clearBtnClicked = false;\n  modes = [] as string[];\n  nativeModalOptions: ModalOptions = {} as any;\n  prevDatavalue: any;\n\n  constructor(props: WmDatetimeProps, defaultClass = DEFAULT_CLASS, defaultProps = new WmDatetimeProps(), defaultState= new BaseDatetimeState()) {\n    super(props, defaultClass, defaultProps, defaultState);\n  }\n\n  format(date: Date | number | undefined, format: string) {\n    if (format === 'timestamp') {\n      return date instanceof Date ? '' + date.getTime() : date;\n    }\n    return date && moment(date).format(format);\n  }\n\n  parse(date: string | number, format: string) {\n    if (format === 'timestamp') {\n      if (isString(date)) {\n        return new Date(parseInt(date));\n      }\n      if (isNumber(date)) {\n        return new Date(date);\n      }\n    }\n    return date && moment(date, format).toDate();\n  }\n\n  private monitorAndUpdateCurrentTime() {\n    this.stopCurrentTimeMonitor();\n    const timerId = setInterval(() => {\n      this.updateState({\n        props: {\n          readonly: true,\n          datavalue: Date.now()\n        },\n        timerId: timerId\n      } as any as BaseDatetimeState);\n    }, 1000);\n  }\n\n  private stopCurrentTimeMonitor() {\n    if (this.state.timerId) {\n      clearInterval(this.state.timerId as any);\n    }\n  }\n\n  convertTimezone(date: any){ \n    const timezone = AppI18nService.getTimezone();\n    if (timezone) {\n      const parsedDateString = new Date(date).toLocaleString(this.props.locale ? this.props.locale : 'en-us', { timeZone: timezone });\n      return moment(parsedDateString, 'M/D/YYYY, h:mm:ss A');\n    }\n    else {\n      return null;\n    }\n  }\n\n  onPropertyChange(name: string, $new: any, $old: any) {\n    super.onPropertyChange(name, $new, $old);\n    const props = this.state.props;\n    switch(name) {\n      //@ts-ignore\n      case 'datavalue':\n        this.invokeEventCallback('onChange', [null, this, $new, $old]);\n        this.prevDatavalue = $old;\n        if (props.datavalue === CURRENT_TIME) {\n          this.monitorAndUpdateCurrentTime();\n        }\n      case 'datepattern':\n      case 'outputformat':\n        if (props.datavalue && props.outputformat && props.datepattern) {\n          let datavalue: any = props.datavalue;\n          if (datavalue === CURRENT_DATE || datavalue === CURRENT_TIME) {\n            datavalue = new Date() as any;\n          }\n          const date = isString(datavalue) ? this.parse(datavalue as string, props.outputformat) : datavalue;\n          datavalue = this.convertTimezone(datavalue);\n          this.updateState({\n            dateValue : date,\n            displayValue: this.format(datavalue?datavalue:date as any, props.datepattern)\n          } as BaseDatetimeState);\n        } else {\n          this.updateState({\n            dateValue : null as any,\n            displayValue: null as any\n          } as BaseDatetimeState);\n        }\n        this.props.onFieldChange && this.props.onFieldChange('datavalue', props.datavalue, this.prevDatavalue);\n        break;\n      case 'mindate':\n        if (isString($new)) {\n          const minDateVal = ($new === CURRENT_DATE || $new === CURRENT_TIME) ? new Date() : props.mindate;\n          this.updateState({\n            props: {\n              mindate: moment(minDateVal, props.datepattern).toDate()\n            }\n          } as BaseDatetimeState);\n        }\n        break;\n      case 'maxdate':\n        if (isString($new)) {\n          const maxDateVal = ($new === CURRENT_DATE || $new === CURRENT_TIME) ? new Date() : props.maxdate;\n          this.updateState({\n            props: {\n              maxdate: moment(maxDateVal, props.datepattern).toDate()\n            }\n          } as BaseDatetimeState);\n        }\n        break;\n      case 'readonly':\n        this.updateState({\n          props: {\n            disabled: $new\n          }\n        } as BaseDatetimeState)\n        break;\n    }\n  }\n\n  onDateChange($event: DateTimePickerEvent, date?: Date) {\n    this.validate(date);\n    this.modes.shift();\n    this.updateState({\n      isFocused: false,\n      showDatePicker: !!this.modes.length,\n      props: {\n        datavalue: this.format(date, this.state.props.outputformat as string),\n        timestamp: this.format(date, 'timestamp')\n      }\n    } as BaseDatetimeState);\n  }\n\n  onBlur() {\n    if (Platform.OS === 'web') {\n      this.validate(this.state.props.datavalue);\n      setTimeout(() => this.props.triggerValidation && this.props.triggerValidation());\n    }\n    this.invokeEventCallback('onBlur', [null, this]);\n  }\n\n  onFocus() {\n    if (!this.state.props.readonly) {\n      if (Platform.OS !== 'web' && this.state.props.mode === 'datetime') {\n        this.modes = ['date', 'time'];\n      } else {\n        this.modes = [this.state.props.mode];\n      }\n      this.updateState({showDatePicker: true, isFocused: true} as BaseDatetimeState);\n      this.invokeEventCallback('onFocus', [null, this]);\n    }\n  }\n\n  validate(value: any) {\n    const validationObj = validateField(this.state.props, value);\n    this.setState({\n      isValid: validationObj.isValid,\n      errorType: validationObj.errorType\n    } as BaseDatetimeState)\n  }\n\n  componentWillUnmount() {\n    super.componentWillUnmount();\n    this.stopCurrentTimeMonitor();\n  }\n\n  renderWebWidget(props: WmDatetimeProps) {\n    return (<WebDatePicker\n      mode={this.state.props.mode}\n      locale={props.locale}\n      value={this.state.dateValue || new Date()}\n      onDateChange={(date: Date) => this.onDateChange(null as any, date)}\n      onDismiss={() =>\n        this.updateState({\n          isFocused: false,\n          showDatePicker: false\n        } as BaseDatetimeState, () => this.onBlur())}\n      minimumDate={props.mindate as Date}\n      maximumDate={props.maxdate as Date}/>);\n  }\n\n  renderNativeWidget(props: WmDatetimeProps, onDismiss?: Function) {\n    return (<DateTimePicker\n      mode={this.modes[0] as any}\n      {...getAccessibilityProps(AccessibilityWidgetType.DATE, {...this.state.props})}\n      value={this.state.dateValue || new Date()}\n      is24Hour={true}\n      display='default'\n      onChange={(event: DateTimePickerEvent, date?: Date) => {\n        if (date && this.state.props.mode === 'datetime' && this.modes[0] === 'time') {\n          const dateSelected = this.state.dateValue;\n          date = moment(date)\n            .set('month', dateSelected.getMonth())\n            .set('year', dateSelected.getFullYear())\n            .set('date', dateSelected.getDate())\n            .toDate();\n        }\n        this.onDateChange(event, date || this.state.dateValue);\n        if (this.modes.length <= 1) {\n          this.onBlur();\n          onDismiss && onDismiss();\n        }\n      }}\n      minimumDate={props.mindate as Date}\n      maximumDate={props.maxdate as Date}\n    />\n    );\n  }\n\n  renderNativeIOSWidget(props: WmDatetimeProps, onDismiss?: Function) {\n    let date_change : any = undefined;\n    return (<View style={this.styles.dialog}>\n      <DateTimePicker\n        mode={this.modes[0] as any}\n        value={this.state.dateValue || new Date()}\n        is24Hour={true}\n        display='spinner'\n        onChange={(event: DateTimePickerEvent, date?: Date) => {\n          if (date && this.state.props.mode === 'datetime' && this.modes[0] === 'time') {\n            const dateSelected = this.state.dateValue;\n            date = moment(date)\n              .set('month', dateSelected.getMonth())\n              .set('year', dateSelected.getFullYear())\n              .set('date', dateSelected.getDate())\n              .toDate();\n          }\n          date_change = date;\n        }}\n        minimumDate={props.mindate as Date}\n        maximumDate={props.maxdate as Date}\n      />\n      <View style={this.styles.actionWrapper}>\n        <WmButton styles={this.styles.selectBtn} caption='Select' onTap={() => {\n          this.onDateChange(null as any, date_change || this.state.dateValue || new Date());\n          if (this.modes.length <= 1) {\n            this.onBlur();\n            onDismiss && onDismiss();\n          }\n        }} />\n        <WmButton styles={this.styles.cancelBtn} caption='Cancel' onTap={() => {\n          this.modes.shift();\n          this.onDateChange(null as any, this.state.dateValue || undefined);\n          this.onBlur();\n          onDismiss && onDismiss();\n        }} />\n      </View>\n    </View>\n    );\n  }\n\n  renderNativeIOSWidgetWithModal(props: WmDatetimeProps) {\n    return (<ModalConsumer>{(modalService: ModalService) => {\n      this.nativeModalOptions.content = (<>\n        {this.renderNativeIOSWidget(props, () => modalService.hideModal(this.nativeModalOptions))}\n        </>);\n      this.nativeModalOptions.centered = true;\n      this.nativeModalOptions.onClose = () => {\n        this.onBlur();\n      };\n      modalService.showModal(this.nativeModalOptions);\n      return null;\n    }}</ModalConsumer>);\n  }\n\n  renderNativeWidgetWithModal(props: WmDatetimeProps) {\n    return (<ModalConsumer>{(modalService: ModalService) => {\n      this.nativeModalOptions.content = (<>\n        {this.renderNativeWidget(props, () => modalService.hideModal(this.nativeModalOptions))}\n        </>);\n      this.nativeModalOptions.centered = true;\n      this.nativeModalOptions.onClose = () => {\n        this.onBlur();\n      };\n      modalService.showModal(this.nativeModalOptions);\n      return null;\n    }}</ModalConsumer>);\n  }\n\n  addTouchableOpacity(props: WmDatetimeProps, children: React.ReactNode, styles?: any) : React.ReactNode{\n    return (\n      <TouchableOpacity \n        {...this.getTestPropsForAction()} \n        style={styles} onPress={() => {\n        if (!props.readonly) {\n          this.onFocus();\n        }\n        this.invokeEventCallback('onTap', [null, this]);\n      }}>\n        {children}\n      </TouchableOpacity>\n    );\n  }\n\n  getIcon() {\n    if (this.state.props.mode === 'time') {\n      return 'wm-sl-l sl-time'\n    }\n    return 'wm-sl-l sl-calendar';\n  }\n\n  renderWidget(props: WmDatetimeProps) {\n    return ( \n        this.addTouchableOpacity(props, (\n        <View style={[this.styles.root, this.state.isValid ? {} : this.styles.invalid, this.state.isFocused ? this.styles.focused : null]}>\n          {this._background}\n            {props.floatinglabel ? (\n            <FloatingLabel\n              moveUp={!!(props.datavalue || this.state.isFocused)}\n              label={props.floatinglabel ?? props.placeholder} \n              style={{\n                ...(this.styles.floatingLabel || []),\n                ...(this.state.isFocused ? (this.styles.activeFloatingLabel || {}) : {})\n              }}\n              />\n          ) : null}\n            <View style={this.styles.container}>\n              {this.addTouchableOpacity(props, (\n                <Text style={[\n                  this.styles.text,\n                  this.state.displayValue ? {} : this.styles.placeholderText\n                ]}\n                {...this.getTestPropsForLabel()}>\n                  {this.state.displayValue \n                    || (props.floatinglabel ? ''  : this.state.props.placeholder)}\n                </Text>\n              ), [{ flex: 1}, this.isRTL?{flexDirection:'row', textAlign:'right'}:{}] )}\n              {(!props.readonly && props.datavalue &&\n                (<WmIcon iconclass=\"wi wi-clear\"\n                styles={{color: this.styles.text.color, ...this.styles.clearIcon}}\n                id={this.getTestId('clearicon')}\n                onTap={() => {\n                  this.onDateChange(null as any, null as any);\n                  this.clearBtnClicked = true;\n                }}/>)) || null}\n              {this.addTouchableOpacity(props, (\n                <WmIcon iconclass={this.getIcon()} styles={{color: this.styles.text.color, ...this.styles.calendarIcon}}/>\n              ))}\n            </View>\n          {\n            this.state.showDatePicker\n            && ((Platform.OS === 'web' && this.renderWebWidget(props))\n              || (Platform.OS === 'android' && this.renderNativeWidget(props))\n              || (Platform.OS === 'ios' && this.renderNativeIOSWidgetWithModal(props)))\n          }\n        </View>\n        ))\n    );\n  }\n}\n\n"],"mappings":"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"}