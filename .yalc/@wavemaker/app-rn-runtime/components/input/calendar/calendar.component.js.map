{"version":3,"names":["React","View","isString","moment","BaseComponent","BaseComponentState","MonthView","WmCalendarProps","DEFAULT_CLASS","WmIcon","WmCalendarState","constructor","arguments","_defineProperty","Map","DEFAULT_DATE_FORMAT","WmCalendar","props","date","d","format","dateWindow","state","calendar","get","updateState","datavalue","selectedDate","invokeEventCallback","events","createElement","iconclass","iconsize","styles","root","marginTop","alignSelf","icon","Math","min","length","Fragment","prepareDataset","dataset","eventStartKey","eventstart","forEach","startDate","has","set","push","onPropertyChange","name","$new","$old","componentDidUpdate","prevProps","prevState","snapshot","renderWidget","style","_background","selectDate","onDateChange","renderChildDay","renderDay","containerStyle","dateSelectedWarpDayStyle","selectedDay","selectedDayTextStyle","selectedDayText","warpRowWeekdays","weekDay","warpRowControlMonthYear","calendarHeader","weekdayStyle","weekDayText","warpDayStyle","dayWrapper","textDayStyle","day","yearTextStyle","yearText","monthTextStyle","monthText","currentDayStyle","today","currentDayTextStyle","todayText","notDayOfCurrentMonthStyle","notDayOfCurrentMonth","renderPrevYearButton","id","getTestId","prevYearBtn","renderPrevMonthButton","prevMonthBtn","renderNextMonthButton","nextMonthBtn","renderNextYearButton","nextYearBtn"],"sources":["calendar.component.tsx"],"sourcesContent":["import React from 'react';\nimport { View } from 'react-native';\nimport { isString } from 'lodash';\nimport moment, { Moment } from 'moment';\nimport { BaseComponent, BaseComponentState } from '@wavemaker/app-rn-runtime/core/base.component';\n\nimport { MonthView } from './views/month-view';\nimport WmCalendarProps from './calendar.props';\nimport { DEFAULT_CLASS, WmCalendarStyles } from './calendar.styles';\nimport WmIcon from '../../basic/icon/icon.component';\n\nexport class WmCalendarState extends BaseComponentState<WmCalendarProps> {\n  selectedDate: Moment = moment();\n  calendar: Map<String, { date: number, events: any []}> = new Map();\n}\n\nconst DEFAULT_DATE_FORMAT = 'DD-MM-YYYY';\n\nexport default class WmCalendar extends BaseComponent<WmCalendarProps, WmCalendarState, WmCalendarStyles> {\n\n  constructor(props: WmCalendarProps) {\n    super(props, DEFAULT_CLASS, new WmCalendarProps(), new WmCalendarState());\n  }\n\n  onDateChange = (date: Moment) => {\n    const d = moment(date).format(DEFAULT_DATE_FORMAT);\n    const dateWindow = this.state.calendar.get(d);\n    this.updateState({\n      props: {datavalue: d},\n      selectedDate: date\n    } as WmCalendarState);\n    this.invokeEventCallback('onSelect', [d, d, this, dateWindow?.events]);\n  }\n\n  prepareDataset(dataset: any[]) {\n    if (!dataset) {\n      return;\n    }\n    const state = {\n      calendar: new Map()\n    } as WmCalendarState;\n    const eventStartKey = this.state.props.eventstart;\n    dataset.forEach(d => {\n      let startDate = d[eventStartKey];\n      if (!isString(startDate)) {\n        startDate = moment(startDate).format(DEFAULT_DATE_FORMAT);\n      }\n      if (!state.calendar.has(startDate)) {\n        state.calendar.set(startDate, {\n          date: moment(startDate, DEFAULT_DATE_FORMAT).get('milliseconds'),\n          events: []\n        });\n      }\n      const dateWindow = state.calendar.get(startDate);\n      dateWindow?.events.push(d);\n    });\n    this.updateState(state);\n  }\n\n  onPropertyChange(name: string, $new: any, $old: any) {\n    switch(name) {\n      case 'dataset':\n        this.prepareDataset($new);\n        break;\n      case 'datavalue':\n        if ($new) {\n          this.updateState({\n            selectedDate: isString($new) ? moment($new, DEFAULT_DATE_FORMAT) : moment($new)\n          } as WmCalendarState)\n      }\n    }\n  }\n\n  renderDay = (date: Moment) => {\n    const dateWindow = this.state.calendar.get(moment(date).format(DEFAULT_DATE_FORMAT));\n    if (dateWindow) {\n      return (\n        <WmIcon\n          iconclass=\"fa fa-circle\"\n          iconsize={8}\n          styles={{\n            root: {marginTop: -8, alignSelf: 'flexStart'},\n            icon: this.styles['eventDay' + Math.min(3, dateWindow.events.length)]}}></WmIcon>\n      );\n    }\n    return (<></>);\n  }\n\n  componentDidUpdate(prevProps: WmCalendarProps, prevState: WmCalendarState, snapshot: any) {\n    super.componentDidUpdate && super.componentDidUpdate(prevProps, prevState, snapshot);\n    this.invokeEventCallback('onViewrender', [this, null]);\n  }\n\n  renderWidget(props: WmCalendarProps) {\n    this.invokeEventCallback('onBeforerender', [null, this]);\n    return (\n      <View style={this.styles.root}>\n        {this._background}\n        <MonthView\n            date={this.state.selectedDate}\n            selectDate={this.onDateChange}\n            format={DEFAULT_DATE_FORMAT}\n            renderChildDay={this.renderDay}\n            containerStyle={this.styles.calendar}\n            dateSelectedWarpDayStyle={this.styles.selectedDay}\n            selectedDayTextStyle={this.styles.selectedDayText}\n            warpRowWeekdays={this.styles.weekDay}\n            warpRowControlMonthYear={this.styles.calendarHeader}\n            weekdayStyle={this.styles.weekDayText}\n            warpDayStyle={this.styles.dayWrapper}\n            textDayStyle={this.styles.day}\n            yearTextStyle={this.styles.yearText}\n            monthTextStyle={this.styles.monthText}\n            currentDayStyle={this.styles.today}\n            currentDayTextStyle={this.styles.todayText}\n            notDayOfCurrentMonthStyle={this.styles.notDayOfCurrentMonth}\n            renderPrevYearButton={() =>\n              (<WmIcon id={this.getTestId('prevyearicon')} iconclass=\"wi wi-angle-double-left\" styles={this.styles.prevYearBtn}/>)}\n            renderPrevMonthButton={() =>\n              (<WmIcon id={this.getTestId('prevmonthicon')} iconclass=\"wi wi-chevron-left fa-2x\" styles={this.styles.prevMonthBtn}/>)}\n            renderNextMonthButton={() =>\n                (<WmIcon id={this.getTestId('nextmonthicon')} iconclass=\"wi wi-chevron-right fa-2x\" styles={this.styles.nextMonthBtn}/>)}\n            renderNextYearButton={() =>\n                (<WmIcon  id={this.getTestId('nextyearicon')} iconclass=\"wi wi-angle-double-right\" styles={this.styles.nextYearBtn}/>)}\n          />\n      </View>\n    );\n  }\n}\n"],"mappings":"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"}