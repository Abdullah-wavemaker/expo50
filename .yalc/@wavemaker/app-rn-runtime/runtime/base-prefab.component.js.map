{"version":3,"names":["React","View","merge","PartialProvider","WmPrefabContainer","BaseFragment","axios","BasePrefab","constructor","props","defualtProps","partialService","_defineProperty","App","appConfig","app","Actions","Variables","appUrl","url","resourceBaseUrl","baseUrl","prefabname","watcher","parentWatcher","create","getServiceDefinitions","onComponentInit","w","targetWidget","onFragmentReady","_renderPrefab","component","renderPrefab","then","onContentReady","invokeEventCallback","refresh","Promise","resolve","resetAppLocale","appLocale","messages","prefabMessages","Object","values","fragments","forEach","f","componentWillUnmount","renderWidget","_props$styles","createElement","value","style","width","styles","root","_class","prefabName","defs","SERVICE_DEFINITION_CACHE","get","catch","response","_response$data","serviceDefinitions","data","serviceDefs"],"sources":["base-prefab.component.tsx"],"sourcesContent":["import React from 'react';\nimport { View } from 'react-native';\nimport { merge } from 'lodash-es';\n\nimport { BaseComponent } from '@wavemaker/app-rn-runtime/core/base.component';\nimport PartialService, { PartialProvider } from '@wavemaker/app-rn-runtime/core/partial.service';\nimport WmPrefabContainer from '@wavemaker/app-rn-runtime/components/prefab/prefab-container.component';\nimport BaseFragment, { FragmentProps, FragmentState } from './base-fragment.component';\nimport axios from 'axios';\nimport { Watcher } from './watcher';\n\n\nexport interface PrefabProps extends FragmentProps {\n  prefabname: string;\n  parentWatcher: Watcher;\n}\n\nexport interface PrefabState extends FragmentState<PrefabProps> {}\n\nexport default abstract class BasePrefab extends BaseFragment<PrefabProps, PrefabState> {\n\n    private static SERVICE_DEFINITION_CACHE = {} as any;\n\n    public static getServiceDefinitions = (prefabName: string, url: string) => {\n      const defs = BasePrefab.SERVICE_DEFINITION_CACHE[prefabName];\n      if (defs) {\n        return Promise.resolve(defs);\n      } else {\n        return axios.get(url + '/servicedefs')\n          .catch(() => ({}))\n          .then((response: any) => {\n              const serviceDefinitions = response?.data?.serviceDefs || {};\n              BasePrefab.SERVICE_DEFINITION_CACHE[prefabName] = serviceDefinitions;\n              return Promise.resolve(serviceDefinitions);\n          });\n      }\n    };\n\n    private appUrl = '';\n    private prefabParams: any = {};\n    private _renderPrefab:() => React.ReactNode = null as any;\n\n    constructor(props: PrefabProps, defualtProps: PrefabProps, private partialService: PartialService) {\n      super(props, defualtProps);\n      this.App = this.appConfig.app;\n      this.Actions = {};\n      this.Variables = {};\n      this.appUrl = this.appConfig.url;\n      this.resourceBaseUrl = `${this.baseUrl}/app/prefabs/${props.prefabname}`;\n      this.baseUrl = `${this.baseUrl}/prefabs/${props.prefabname}`;\n      this.watcher = props.parentWatcher.create();\n    }\n\n    getServiceDefinitions() {\n      return BasePrefab.getServiceDefinitions(this.props.prefabname, `${this.appUrl}/services/prefabs/${this.props.prefabname}`);\n    }\n\n    onComponentInit(w: BaseComponent<any, any, any>) {\n      super.onComponentInit(w);\n      if (w instanceof WmPrefabContainer) {\n        this.targetWidget = w;\n      }\n    }\n\n    onFragmentReady(): Promise<void> {\n      this._renderPrefab = () => {\n        const component = this.renderPrefab();\n        super.onFragmentReady()\n        .then(() => {\n          this.onContentReady();\n          this.invokeEventCallback('onLoad', [null, this]);\n        });\n        this._renderPrefab = () => this.renderPrefab();\n        return component;\n      };\n      this.refresh();\n      return Promise.resolve();\n    }\n\n    resetAppLocale() {\n      this.appLocale = merge({ }, this.appConfig.appLocale.messages, this.appConfig.appLocale.prefabMessages[this.props.prefabname]);\n      Object.values(this.fragments).forEach((f: any) => (f as BaseFragment<any, any>).resetAppLocale());\n    }\n\n    componentWillUnmount() {\n      super.componentWillUnmount();\n      this.invokeEventCallback('onDestroy', [null, this]);\n    }\n\n    abstract renderPrefab(): React.ReactNode;\n\n    renderWidget(props: PrefabProps) {\n      return (\n        <PartialProvider value={this.partialService}>\n          <View style={[{width: '100%'}, props.styles?.root]}>\n            {this._renderPrefab ? this._renderPrefab(): null}\n          </View>\n        </PartialProvider>\n      );\n    }\n}\n"],"mappings":"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"}