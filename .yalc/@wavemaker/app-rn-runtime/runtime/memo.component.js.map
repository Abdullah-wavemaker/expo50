{"version":3,"names":["React","WmMemo","Component","constructor","props","_defineProperty","setState","id","state","watcher","create","shouldComponentUpdate","nextProps","nextState","Object","keys","reduce","p","k","componentWillUnmount","destroy","watch","fn","refresh","value","render","clear","bind"],"sources":["memo.component.tsx"],"sourcesContent":["import React from \"react\";\nimport { Watcher } from \"./watcher\";\n\ninterface MemoProps {\n    watcher: Watcher;\n    render: (watch: Function) => React.ReactNode\n}\n\ninterface MemoState {\n    id: number;\n}\n\nexport class WmMemo extends React.Component<MemoProps, MemoState> {\n\n    private watcher: Watcher = null as any;\n\n    constructor(props: MemoProps) {\n        super(props);\n        this.watcher = props.watcher.create();\n        this.state = {\n            id: 0\n        }\n    }\n\n    shouldComponentUpdate(nextProps: any, nextState: any) {\n        return Object.keys(nextProps).reduce((p, k) => {\n            return p || (k !== 'render' && (this.props as any)[k] !== nextProps[k]);\n        }, false) || this.state.id !== nextState.id;\n    }\n\n    componentWillUnmount() {\n        this.watcher && this.watcher.destroy();\n    }\n\n    refresh = () => {\n        this.setState({\n            id: this.state.id + 1\n        });\n    }\n\n     watch(fn: Function) {\n        return this.watcher.watch(fn, this.refresh).value;\n     }\n\n    render() {\n        this.watcher.clear();\n        return this.props.render(this.watch.bind(this));\n    }\n}"],"mappings":";;;AAAA,OAAOA,KAAK,MAAM,OAAO;AAYzB,OAAO,MAAMC,MAAM,SAASD,KAAK,CAACE,SAAS,CAAuB;EAI9DC,WAAWA,CAACC,KAAgB,EAAE;IAC1B,KAAK,CAACA,KAAK,CAAC;IAACC,eAAA,kBAHU,IAAI;IAAAA,eAAA,kBAoBrB,MAAM;MACZ,IAAI,CAACC,QAAQ,CAAC;QACVC,EAAE,EAAE,IAAI,CAACC,KAAK,CAACD,EAAE,GAAG;MACxB,CAAC,CAAC;IACN,CAAC;IApBG,IAAI,CAACE,OAAO,GAAGL,KAAK,CAACK,OAAO,CAACC,MAAM,CAAC,CAAC;IACrC,IAAI,CAACF,KAAK,GAAG;MACTD,EAAE,EAAE;IACR,CAAC;EACL;EAEAI,qBAAqBA,CAACC,SAAc,EAAEC,SAAc,EAAE;IAClD,OAAOC,MAAM,CAACC,IAAI,CAACH,SAAS,CAAC,CAACI,MAAM,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAK;MAC3C,OAAOD,CAAC,IAAKC,CAAC,KAAK,QAAQ,IAAK,IAAI,CAACd,KAAK,CAASc,CAAC,CAAC,KAAKN,SAAS,CAACM,CAAC,CAAE;IAC3E,CAAC,EAAE,KAAK,CAAC,IAAI,IAAI,CAACV,KAAK,CAACD,EAAE,KAAKM,SAAS,CAACN,EAAE;EAC/C;EAEAY,oBAAoBA,CAAA,EAAG;IACnB,IAAI,CAACV,OAAO,IAAI,IAAI,CAACA,OAAO,CAACW,OAAO,CAAC,CAAC;EAC1C;EAQCC,KAAKA,CAACC,EAAY,EAAE;IACjB,OAAO,IAAI,CAACb,OAAO,CAACY,KAAK,CAACC,EAAE,EAAE,IAAI,CAACC,OAAO,CAAC,CAACC,KAAK;EACpD;EAEDC,MAAMA,CAAA,EAAG;IACL,IAAI,CAAChB,OAAO,CAACiB,KAAK,CAAC,CAAC;IACpB,OAAO,IAAI,CAACtB,KAAK,CAACqB,MAAM,CAAC,IAAI,CAACJ,KAAK,CAACM,IAAI,CAAC,IAAI,CAAC,CAAC;EACnD;AACJ"}