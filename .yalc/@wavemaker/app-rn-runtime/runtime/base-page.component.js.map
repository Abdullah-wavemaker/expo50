{"version":3,"names":["clone","isEqual","React","CommonActions","WmPage","NavigationServiceProvider","AppSecurityService","AppSpinnerService","BaseFragment","Watcher","BasePage","constructor","props","_this$appConfig$drawe","_defineProperty","pageName","route","name","pageParams","params","appConfig","currentPage","drawer","setContent","serviceDefinitions","App","watcher","ROOT","create","canUserAccessPage","then","flag","cache","redirectToLogin","onComponentInit","w","targetWidget","refreshdataonattach","toggleDrawer","navigation","setDrawerContent","content","arguments","length","undefined","drawerContent","drawerType","hasDrawer","setTimeout","proxy","_this$appConfig$drawe2","_this$appConfig$drawe4","_this$appConfig$drawe3","createElement","value","setAnimation","onAttach","onFragmentReady","onContentReady","onPageReady","hide","cleanup","push","addListener","refresh","componentWillUnmount","goToPage","clearCahe","_params","dispatch","reset","index","routes","navigate","onDetach","destroyMe","closeDrawer","Promise","resolve","goBack","canGoBack","window","history","back","openUrl","url","startsWith","substring","splits","split","map","p","forEach","openBrowser","isActiveTabbarItem","_ref","label","link","links","possibleLinks","find","l","includes","renderWidget","renderPage"],"sources":["base-page.component.tsx"],"sourcesContent":["import { clone, isEqual } from 'lodash';\nimport React, { ReactNode } from 'react';\nimport { CommonActions } from '@react-navigation/native';\nimport { BaseComponent } from '@wavemaker/app-rn-runtime/core/base.component';\n\nimport WmPage from '@wavemaker/app-rn-runtime/components/page/page.component';\nimport NavigationService, { NavigationServiceProvider } from '@wavemaker/app-rn-runtime/core/navigation.service';\n\nimport AppSecurityService from './services/app-security.service';\nimport AppSpinnerService from './services/app-spinner.service';\nimport BaseFragment, { FragmentProps, FragmentState } from './base-fragment.component';\nimport { Watcher } from './watcher';\n\ndeclare const window: any;\n\nexport interface PageProps extends FragmentProps {\n  route: any;\n  navigation: any;\n  destroyMe: Function;\n}\n\nexport interface PageState extends FragmentState<PageProps> {}\n\nexport default abstract class BasePage extends BaseFragment<PageProps, PageState> implements NavigationService {\n    private pageName = null as unknown as string;\n    private pageParams: any = {};\n    private hasDrawer = false;\n    private hasTabbar = false;\n    private drawerContent = null as React.ReactNode;\n    private drawerType = '';\n\n    constructor(props: PageProps) {\n      super(props);\n      this.pageName = props.route.name;\n      this.pageParams = props.route.params;\n      this.appConfig.currentPage = this;\n      this.appConfig.drawer?.setContent(null);\n      this.serviceDefinitions = this.App.serviceDefinitions;\n      this.watcher = Watcher.ROOT.create();\n      AppSecurityService.canUserAccessPage(this.pageName)\n        .then(flag => {\n          if (!flag) {\n            this.cache = false;\n            AppSecurityService.redirectToLogin();\n          }\n        });\n    }\n\n    onComponentInit(w: BaseComponent<any, any, any>) {\n      super.onComponentInit(w);\n      if (w instanceof WmPage) {\n        this.targetWidget = w;\n        const props = w.props as any;\n        this.cache = !(props.cache === false);\n        this.refreshdataonattach = !(props.refreshdataonattach === false);\n      }\n    }\n\n    toggleDrawer() {\n      (this.props as PageProps).navigation.toggleDrawer();\n    }\n\n    setDrawerContent(content = this.drawerContent, drawerType = this.drawerType) {\n      if (!content) {\n        return;\n      }\n      this.drawerContent = content;\n      this.drawerType = drawerType;\n      this.hasDrawer = true;\n      setTimeout(() => {\n        if (this.appConfig.currentPage === this \n          || this.appConfig.currentPage.proxy === this) {\n          this.appConfig.drawer?.setContent(null);\n          setTimeout(() => {\n            this.appConfig.drawer?.setContent((\n              <NavigationServiceProvider value={this}>\n              {content}\n              </NavigationServiceProvider>));\n          }, 500);\n          this.appConfig.drawer?.setAnimation(drawerType);\n        }\n      }, 10);\n    }\n\n    onAttach() {\n      super.onAttach();\n      this.setDrawerContent();\n    }\n\n    onFragmentReady() {\n      return super.onFragmentReady().then(() => {\n        this.onContentReady();\n        this.App.onPageReady(this.pageName, this.proxy as BasePage);\n        AppSpinnerService.hide(); \n        this.cleanup.push((this.props as PageProps).navigation.addListener('focus', () => {\n          if (this.appConfig.currentPage !== this) {\n            this.appConfig.currentPage = this;\n            this.onAttach();\n            this.appConfig.refresh();\n          }\n        }));\n      });\n    }\n\n    componentWillUnmount() {\n      super.componentWillUnmount();\n    }\n\n    goToPage(pageName: string, params: any, clearCahe = false) {\n      const navigation = (this.props as PageProps).navigation;\n      const _params = clone(params);\n      _params && delete _params['pageName'];\n      if (pageName !== this.pageName || !isEqual(_params, this.pageParams)) {\n        if (pageName === this.pageName) {\n          navigation.push(pageName, _params);\n        } else if (clearCahe) {\n          navigation.dispatch(CommonActions.reset({\n            index: 0,\n            routes: [\n              { name: pageName, params: params }\n            ]}));\n        } else {\n          navigation.navigate(pageName, _params);\n        }\n        if (this.cache) {\n          this.onDetach();\n        } else {\n          this.props.destroyMe();\n        }\n      } else {\n        (this.props as PageProps).navigation.closeDrawer();\n      }\n      return Promise.resolve();\n    }\n\n    goBack() {\n      const navigation = (this.props as PageProps).navigation;\n      if (navigation.canGoBack()) {\n        navigation.goBack();\n      } else if (window && window.history) {\n        window.history.back();\n      }\n      return Promise.resolve();\n    }\n\n    openUrl(url: string, params = {} as any) {\n      if (url) {\n        if (url.startsWith('#')) {\n          url = url.substring(1);\n          url = url.startsWith('/') ? url.substring(1) : url;\n          const splits = url.split('?');\n          const pageName = splits[0];\n          let params = {} as any;\n          if (splits.length > 1) {\n            splits[1].split('&')\n              .map(p => p.split('='))\n              .forEach(p => params[p[0]] = p[1]);\n          }\n          return this.goToPage(pageName, params);\n        } else {\n          this.App.openBrowser(url, params);\n        }\n      }\n      return Promise.resolve();\n    }\n\n    isActiveTabbarItem({label, link, links}: {label: string, link: string, links: string[]}) {\n      const pageName = this.pageName;\n      const possibleLinks = [pageName, '#' + pageName, '#/' + pageName];\n      return links && links.find(l => possibleLinks.includes(l));\n    }\n\n    abstract renderPage(): ReactNode;\n\n    renderWidget(props: PageProps) {\n      return this.renderPage();\n    }\n}\n"],"mappings":"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"}