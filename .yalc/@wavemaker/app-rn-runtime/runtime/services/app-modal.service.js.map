{"version":3,"names":["BackHandler","injector","AppModalService","constructor","_defineProperty","modalsOpened","length","hideModal","clearBackButtonPress","removeEventListener","handleBackButtonPress","setBackButtonPress","addEventListener","getAppConfig","appConfig","get","showLastModal","modalOptions","refresh","setTimeout","onOpen","showModal","options","i","findIndex","o","elevationIndex","parseInt","app","toastsOpened","push","Promise","resolve","then","animatedRefs","triggerExit","onClose","splice","appModalService"],"sources":["app-modal.service.tsx"],"sourcesContent":["import { BackHandler } from \"react-native\";\n\nimport injector from '@wavemaker/app-rn-runtime/core/injector';\nimport AppConfig from '@wavemaker/app-rn-runtime/core/AppConfig';\nimport { ModalOptions, ModalService } from '@wavemaker/app-rn-runtime/core/modal.service';\n\nclass AppModalService implements ModalService {\n    public modalOptions = {} as ModalOptions;\n\n    public modalsOpened = [] as ModalOptions[];\n    public appConfig: any;\n\n    animatedRefs: any = [];\n\n    private clearBackButtonPress() {\n      BackHandler.removeEventListener('hardwareBackPress', this.handleBackButtonPress);\n    }\n\n    private setBackButtonPress() {\n      this.clearBackButtonPress();\n      if (this.modalsOpened.length > 0) {\n        BackHandler.addEventListener('hardwareBackPress', this.handleBackButtonPress);\n      }\n    }\n\n    private handleBackButtonPress = () => {\n      if (this.modalsOpened.length) {\n        this.hideModal();\n        return true;\n      }\n      return false;\n    }\n\n    private getAppConfig() {\n      if (!this.appConfig) {\n        this.appConfig = injector.get<AppConfig>('APP_CONFIG');\n      }\n      return this.appConfig;\n    }\n\n    private showLastModal() {\n        this.modalOptions = this.modalsOpened.length ? this.modalsOpened[this.modalsOpened.length - 1] : {} as ModalOptions;\n        this.refresh();\n        // widgets in dialog are not accessible. Hence adding setTimeout\n        setTimeout(() => {\n          this.modalOptions.onOpen && this.modalOptions.onOpen();\n        },500);\n        this.setBackButtonPress();\n    }\n\n    public refresh() {\n      this.getAppConfig().refresh();\n    }\n\n    public showModal(options: ModalOptions) {\n        const i = this.modalsOpened.findIndex(o => o === options);\n        if (i < 0) {\n          options.elevationIndex = parseInt(this.getAppConfig().app.toastsOpened + this.modalsOpened.length + 1);\n          this.modalsOpened.push(options);\n            this.showLastModal();\n        }\n    }\n\n    public hideModal(options?: ModalOptions) {\n        const i = options ? this.modalsOpened.findIndex(o => o === options) : (this.modalsOpened.length - 1);\n        if (i >= 0) {\n          Promise.resolve()\n            .then(() => this.modalsOpened.length > 1 && this.animatedRefs && this.animatedRefs[i].triggerExit())\n            .then(() => {\n              const o = this.modalsOpened[i];\n              return o && o.onClose && o.onClose();\n            })\n            .then(() => this.modalsOpened.splice(i, 1))\n            .then(() => this.showLastModal());\n        }\n        this.clearBackButtonPress();\n    }\n}\n\nconst appModalService = new AppModalService();\n\nexport default appModalService;\n"],"mappings":"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"}