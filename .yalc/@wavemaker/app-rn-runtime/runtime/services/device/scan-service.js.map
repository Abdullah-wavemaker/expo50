{"version":3,"names":["Camera","Ionicons","BarCodeScanner","Platform","StyleSheet","TouchableOpacity","View","React","permissionManager","appDisplayManagerService","barcodeFormatOptions","opacity","styles","create","container","flex","flexDirection","closeWrapper","justifyContent","alignItems","paddingBottom","topWrapper","backgroundColor","centerWrapper","leftWrapper","focused","rightWrapper","bottomWrapper","ScanService","constructor","displayManager","getTestProps","suffix","id","OS","accessibilityLabel","testID","accessible","scanBarcode","params","format","barcodeFormat","undefined","Promise","resolve","reject","requestPermissions","then","destroy","show","content","createElement","barCodeScannerSettings","barCodeTypes","Constants","BarCodeType","onBarCodeScanned","result","call","style","absoluteFillObject","_extends","onPress","name","size","color","response","type","values","Object","index","indexOf","keys","text","data","cancelled","scanService"],"sources":["scan-service.tsx"],"sourcesContent":["import { Camera } from 'expo-camera';\nimport { Ionicons } from '@expo/vector-icons';\nimport { BarCodeScanner } from 'expo-barcode-scanner';\nimport * as Application from 'expo-application';\nimport { Platform, StyleSheet, TouchableOpacity, View } from 'react-native';\nimport React from 'react';\nimport { ScanInput, ScanOutput } from '@wavemaker/app-rn-runtime/variables/device/scan/scan.operation';\nimport { DisplayManager } from '@wavemaker/app-rn-runtime/core/display.manager';\nimport permissionManager from '@wavemaker/app-rn-runtime/runtime/services/device/permissions';\nimport appDisplayManagerService from '@wavemaker/app-rn-runtime/runtime/services/app-display-manager.service';\n\ninterface objectMap {\n  [key: string]: string\n}\n\nconst barcodeFormatOptions: objectMap = {\n  'ALL': 'ALL',\n  'CODABAR': 'codabar',\n  'CODE_39': 'code39',\n  'CODE_93': 'code93',\n  'CODE_128': 'code128',\n  'DATA_MATRIX': 'datamatrix',\n  'EAN_8': 'ean8',\n  'EAN_13': 'ean13',\n  'ITF': 'itf14',\n  'PDF_417': 'pdf417',\n  'QR_CODE': 'qr',\n  'RSS14': 'rss14',\n  'RSS_EXPANDED': 'rssexpanded',\n  'UPC_E': 'upc_e',\n  'UPC_A': 'upc_a'\n};\nconst opacity = 'rgba(0, 0, 0, 0.6)';\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    flexDirection: 'column'\n  },\n  closeWrapper: {\n    flex: 1,\n    justifyContent: 'flex-end',\n    alignItems: 'center',\n    paddingBottom: 32\n  },\n  topWrapper: {\n    flex: 2,\n    backgroundColor: opacity\n  },\n  centerWrapper: {\n    flex: 2,\n    flexDirection: 'row'\n  },\n  leftWrapper: {\n    flex: 2,\n    backgroundColor: opacity\n  },\n  focused: {\n    flex: 10\n  },\n  rightWrapper: {\n    flex: 2,\n    backgroundColor: opacity\n  },\n  bottomWrapper: {\n    flex: 2,\n    backgroundColor: opacity\n  },\n});\n\nexport class ScanService {\n\n  constructor(private displayManager: DisplayManager) {}\n\n  getTestProps(suffix: string) {\n    const id = \"scan\" + (suffix ? '_' + suffix  : '');\n    if (Platform.OS === 'android' || Platform.OS === 'web') {\n      return {\n          accessibilityLabel: id,\n          testID: id\n      };\n    }\n    return {\n        accessible: false,\n        testID: id\n    };\n  }\n\n  public scanBarcode(params: ScanInput): Promise<ScanOutput> {\n    const format = params?.barcodeFormat || 'ALL';\n    const barcodeFormat: string | undefined = Platform.OS === 'ios' ? undefined : barcodeFormatOptions[format];\n    return new Promise((resolve, reject) => {\n      permissionManager.requestPermissions('camera').then(() => {\n        const destroy = this.displayManager.show({\n          content: (<Camera\n            barCodeScannerSettings={barcodeFormat ? {\n              barCodeTypes: [BarCodeScanner.Constants.BarCodeType[barcodeFormat]],\n            }: undefined}\n            onBarCodeScanned={(result) => {\n              destroy.call(this.displayManager);\n              resolve(result);\n            }}\n            style={StyleSheet.absoluteFillObject}\n          >\n            <View style={styles.topWrapper}>\n            </View>\n            <View style={styles.centerWrapper}>\n              <View style={styles.leftWrapper}/>\n              <View style={styles.focused}/>\n              <View style={styles.rightWrapper}/>\n            </View>\n            <View style={styles.bottomWrapper}>\n              \n              <View style={styles.closeWrapper}>\n                  <TouchableOpacity\n                      {... this.getTestProps('close_button')}\n                      onPress={() => {\n                        destroy.call(this.displayManager);\n                      }}>\n                      <Ionicons name='close-circle' size={48} color='white' />\n                  </TouchableOpacity>\n              </View>\n            </View>\n          </Camera>)\n        });\n      }, reject)\n    }).then((response: any) => {\n      let format;\n      if (response.type) {\n        const values = Object.values(BarCodeScanner.Constants.BarCodeType);\n        const index = values.indexOf(response.type);\n        format = index > -1 ? Object.keys(BarCodeScanner.Constants.BarCodeType)[index] : '';\n      }\n      return Promise.resolve({\n        text: response.data,\n        format : format || response.type,\n        cancelled : false\n      });\n    });\n  }\n}\nconst scanService = new ScanService(appDisplayManagerService);\nexport default scanService;\n"],"mappings":"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"}