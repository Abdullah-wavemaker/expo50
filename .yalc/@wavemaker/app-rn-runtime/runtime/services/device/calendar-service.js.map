{"version":3,"names":["Calendar","permissionManager","getDateObj","DEFAULT_TIME","Date","getTime","DELTA_VALUE_DATE","DEFAULT_START_DATE","DEFAULT_END_DATE","CalendarService","constructor","getEvents","params","Promise","resolve","reject","requestPermissions","then","getCalendarsAsync","result","calendarIds","forEach","c","push","id","getEventsAsync","eventStart","eventEnd","res","filteredResult","eventTitle","eventLocation","eventNotes","filter","event","title","location","notes","events","e","message","startDate","endDate","createEvent","eventMetadata","allowsModifications","createEventAsync","dataValue","deleteEvent","all","map","deleteEventAsync"],"sources":["calendar-service.ts"],"sourcesContent":["import * as Calendar from 'expo-calendar';\nimport permissionManager from '@wavemaker/app-rn-runtime/runtime/services/device/permissions';\nimport { CalendarInput } from '@wavemaker/app-rn-runtime/core/device/calendar-service';\nimport { CalendarEvent } from '@wavemaker/app-rn-runtime/variables/device/calendar/get-events.operation';\nimport {\n  CreateEventOutput,\n  getDateObj\n} from '@wavemaker/app-rn-runtime/variables/device/calendar/create-event.operation';\nimport { DeleteEventOutput } from '@wavemaker/app-rn-runtime/variables/device/calendar/delete-event.operation';\n\nconst DEFAULT_TIME = new Date().getTime();\nconst DELTA_VALUE_DATE = 3 * 30 * 24 * 60 * 60 * 1000;\nconst DEFAULT_START_DATE = new Date(DEFAULT_TIME - DELTA_VALUE_DATE);\nconst DEFAULT_END_DATE = new Date(DEFAULT_TIME + DELTA_VALUE_DATE);\n\nexport class CalendarService {\n\n  constructor() {}\n\n  public getEvents(params: CalendarInput): Promise<Array<CalendarEvent>> {\n    return new Promise((resolve, reject) => {\n      permissionManager.requestPermissions('calendar').then(() => {\n          return Calendar.getCalendarsAsync().then(result => {\n            let calendarIds: Array<string> = [];\n            result.forEach(c => calendarIds.push(c.id));\n            Calendar.getEventsAsync(calendarIds, params.eventStart || DEFAULT_START_DATE, params.eventEnd || DEFAULT_END_DATE)\n              .then(res => {\n                let filteredResult = res;\n                if (params.eventTitle || params.eventLocation || params.eventNotes) {\n                  filteredResult = res.filter(event => event.title === params.eventTitle || event.location === params.eventLocation || event.notes === params.eventNotes);\n                }\n                let events: Array<CalendarEvent> = [];\n                filteredResult.forEach(e => {\n                  events.push({\n                    title: e.title,\n                    message: e.notes,\n                    location: e.location,\n                    startDate: e.startDate,\n                    endDate: e.endDate\n                  })\n                });\n                return resolve(events);\n              })\n          })\n      }, reject);\n    });\n  }\n\n\n  public createEvent(params: CalendarInput): Promise<CreateEventOutput> {\n    const eventMetadata = {\n      title: params.eventTitle,\n      location: params.eventLocation,\n      notes: params.eventNotes,\n      startDate: getDateObj(params.eventStart) || DEFAULT_START_DATE,\n      endDate: getDateObj(params.eventEnd) || DEFAULT_END_DATE\n    };\n\n    return new Promise((resolve, reject) => {\n      permissionManager.requestPermissions('calendar').then(() => {\n          return Calendar.getCalendarsAsync().then(result => {\n            let calendarIds: Array<string> = [];\n            result.forEach(c => {\n              if (c.allowsModifications) {\n                calendarIds.push(c.id);\n              }\n            });\n            // createEventAsync has calendarId as required parameter. Need to expose ownerAccount as filter field in studio. Right now passing calendar index as zero.\n            return Calendar.createEventAsync(calendarIds[0], eventMetadata).then(res => {\n              const event = {\n                dataValue: res\n              };\n              return resolve(event);\n            })\n          }, reject);\n      });\n    });\n  }\n\n\n  public deleteEvent(params: CalendarInput): Promise<DeleteEventOutput> {\n\n    return new Promise((resolve, reject) => {\n      permissionManager.requestPermissions('calendar').then(() => {\n          return Calendar.getCalendarsAsync().then(result => {\n            let calendarIds: Array<string> = [];\n            result.forEach(c => {\n              if (c.allowsModifications) {\n                calendarIds.push(c.id);\n              }\n            });\n            Calendar.getEventsAsync(calendarIds, params.eventStart || DEFAULT_START_DATE, params.eventEnd || DEFAULT_END_DATE)\n              .then((res) => {\n                const filteredResult = res.filter(event => event.title === params.eventTitle || event.location === params.eventLocation\n                  || event.notes === params.eventNotes);\n                Promise.all(\n                  filteredResult.map((event) => { Calendar.deleteEventAsync(event.id)}))\n                  .then(res => {\n                    const event = {\n                      dataValue: true\n                    }\n                    return resolve(event);\n                  })\n              })\n          }, reject);\n      });\n    });\n  }\n}\n"],"mappings":"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"}