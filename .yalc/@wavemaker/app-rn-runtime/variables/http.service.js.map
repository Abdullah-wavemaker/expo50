{"version":3,"names":["axios","WS_CONSTANTS","isWebPreviewMode","injector","HttpService","send","options","variable","_variable$serviceInfo","serviceInfo","headers","requestBody","data","url","cancelTokenSource","CancelToken","source","consumes","formData","FormData","parameters","forEach","p","v","params","name","append","category","startsWith","replace","config","baseUrl","methodType","method","toLowerCase","isNonDataMethod","NON_DATA_AXIOS_METHODS","indexOf","toUpperCase","axiosConfig","cancelToken","token","withCredentials","Promise","resolve","reject","apply","then","result","err","response","sendCall","requestParams","getLocale","appConfig","get","appLocale","messages","cancel","uploadFile","event","error","httpService"],"sources":["http.service.ts"],"sourcesContent":["import axios from 'axios';\nimport { HttpClientService } from '@wavemaker/variables/src/types/http-client.service';\nimport { WS_CONSTANTS } from '@wavemaker/app-rn-runtime/variables/utils/variable.constants';\nimport { get, isEmpty } from 'lodash';\nimport AppConfig from '@wavemaker/app-rn-runtime/core/AppConfig';\nimport { isWebPreviewMode } from '@wavemaker/app-rn-runtime/core/utils';\nimport injector from '@wavemaker/app-rn-runtime/core/injector';\n\nexport class HttpService implements HttpClientService {\n\n  send(options: any, variable: any) {\n    const serviceInfo = variable.serviceInfo;\n    let headers: any = options.headers,\n      requestBody: any = options.data,\n      url: string = options.url;\n      variable.cancelTokenSource = axios.CancelToken.source();\n    if (!isWebPreviewMode() && (variable?.serviceInfo?.consumes||[])[0] === 'multipart/form-data') {\n      headers['Content-Type'] = 'multipart/form-data';\n      let formData = new FormData();\n      (variable.serviceInfo.parameters||[]).forEach((p: any) => {\n        const v = variable.params[p.name];\n        if (v) {\n          formData.append(p.name, variable.params[p.name]);\n        }\n      });\n      requestBody = formData;\n    }\n    if (!isWebPreviewMode()\n      && variable.category === 'wm.LiveVariable'\n      && !(url.startsWith('http://') || url.startsWith(\"https://\"))) {\n      options.url = options.url.replace('./', '/');\n      url = variable.config.baseUrl + options.url;\n    }\n\n    const methodType: string = serviceInfo?.methodType || options.method.toLowerCase();\n    const isNonDataMethod: boolean = WS_CONSTANTS.NON_DATA_AXIOS_METHODS.indexOf(methodType.toUpperCase()) > -1;\n    const axiosConfig = {\n      headers: headers,\n      cancelToken: variable.cancelTokenSource.token,\n      withCredentials: !isWebPreviewMode() || options?.withCredentials !== false\n    };\n    return new Promise((resolve, reject) => {\n      // @ts-ignore\n      axios[methodType].apply(variable, ( isNonDataMethod ? [url, axiosConfig] : [url, requestBody || {}, axiosConfig]))\n        .then((result: any) => {\n         resolve(result);\n        }, (err: any) => {\n          reject(err.response);\n        })\n    })\n  }\n\n  sendCall(requestParams: any, variable: any) {\n    return new Promise((resolve, reject) => {\n      this.send(requestParams, variable).then((response: any) => {\n          resolve(response);\n      }, (err: any) => {\n        reject(err);\n      });\n    });\n  }\n\n  getLocale() {\n    const appConfig = injector.get<AppConfig>('APP_CONFIG');\n    return appConfig.appLocale.messages;\n  }\n\n  cancel(variable: any) {\n    variable.cancelTokenSource.cancel();\n  }\n\n  uploadFile(url: any, data: any, variable: any, options?: any) {\n    const requestParams = {\n      url: url,\n      data: data\n    }\n    return new Promise((resolve, reject) => {\n      return this.send(requestParams, variable).then((event: any) => {\n        resolve(event.data);\n      }, (error: any) => {\n        reject(error);\n      });\n    });\n  }\n}\n\nconst httpService = new HttpService();\n\nexport default httpService;\n"],"mappings":"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"}