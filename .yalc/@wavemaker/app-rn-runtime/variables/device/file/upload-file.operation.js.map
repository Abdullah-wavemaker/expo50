{"version":3,"names":["axios","Platform","endsWith","DocumentPicker","FileExtensionTypesMap","namedParameters","copyToCacheDirectory","multiple","type","UploadFileOperation","chooseFile","getDocumentAsync","then","response","OS","file","uri","invoke","params","serverUrl","remoteFolder","Promise","resolve","localFile","browse","filePath","fileName","split","pop","arr","fileExtension","length","fileObj","name","formData","FormData","append","url","method","headers","data","error"],"sources":["upload-file.operation.tsx"],"sourcesContent":["import axios from 'axios';\nimport { Platform } from 'react-native';\nimport { endsWith } from 'lodash-es';\nimport * as DocumentPicker from 'expo-document-picker';\n\nimport { Operation } from '@wavemaker/app-rn-runtime/variables/device/operation.provider';\nimport { FileExtensionTypesMap } from '@wavemaker/app-rn-runtime/core/file-extension-types';\n\nexport interface UploadFileInput {\n  localFile: string;\n  remoteFolder: string;\n  serverUrl: string;\n  browse: boolean;\n}\n\nexport interface UploadFileOutput {\n  fileName: string;\n  path: string;\n  length: number;\n  success: boolean;\n  inlinePath: string;\n  errorMessage: string;\n}\n\nconst namedParameters = {\n  copyToCacheDirectory: false,\n  multiple: false,\n  type: '*/*'\n};\n\nexport class UploadFileOperation implements Operation {\n\n  public chooseFile() {\n    return DocumentPicker.getDocumentAsync(namedParameters).then((response: any) => {\n      return Platform.OS === 'web' ? response.file : response.uri;\n    });\n  }\n\n  public invoke(params: UploadFileInput): Promise<UploadFileOutput> {\n    params.serverUrl = endsWith(params.serverUrl, '/') ? params.serverUrl : params.serverUrl + '/';\n    let serverUrl = params.serverUrl + 'services/file/uploadFile';\n    if (params.remoteFolder) {\n      serverUrl = serverUrl + '?relativePath=' + params.remoteFolder\n    }\n    return Promise.resolve().then(() => {\n      if (!params.localFile && params.browse) {\n        return this.chooseFile();\n      } else {\n        return params.localFile;\n      }\n    }).then((filePath: string) => {\n      if (!filePath) {\n        return;\n      }\n      const fileName: string | undefined = filePath.split('/').pop() || '';\n      const arr: any = fileName.split('.');\n      const fileExtension: string = '.' + arr[arr.length - 1];\n      let fileObj = {\n        uri: filePath,\n        type: FileExtensionTypesMap[fileExtension],\n        name: fileName,\n      };\n\n      let formData = new FormData();\n      formData.append('files', fileObj);\n      return axios({\n        url: serverUrl,\n        method: 'POST',\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        },\n        data: formData\n      }).then(\n        (response) => {\n        return response.data[0];\n      }, error => error);\n    });\n  }\n}\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AACzB,SAASC,QAAQ,QAAQ,cAAc;AACvC,SAASC,QAAQ,QAAQ,WAAW;AACpC,OAAO,KAAKC,cAAc,MAAM,sBAAsB;AAGtD,SAASC,qBAAqB,QAAQ,qDAAqD;AAkB3F,MAAMC,eAAe,GAAG;EACtBC,oBAAoB,EAAE,KAAK;EAC3BC,QAAQ,EAAE,KAAK;EACfC,IAAI,EAAE;AACR,CAAC;AAED,OAAO,MAAMC,mBAAmB,CAAsB;EAE7CC,UAAUA,CAAA,EAAG;IAClB,OAAOP,cAAc,CAACQ,gBAAgB,CAACN,eAAe,CAAC,CAACO,IAAI,CAAEC,QAAa,IAAK;MAC9E,OAAOZ,QAAQ,CAACa,EAAE,KAAK,KAAK,GAAGD,QAAQ,CAACE,IAAI,GAAGF,QAAQ,CAACG,GAAG;IAC7D,CAAC,CAAC;EACJ;EAEOC,MAAMA,CAACC,MAAuB,EAA6B;IAChEA,MAAM,CAACC,SAAS,GAAGjB,QAAQ,CAACgB,MAAM,CAACC,SAAS,EAAE,GAAG,CAAC,GAAGD,MAAM,CAACC,SAAS,GAAGD,MAAM,CAACC,SAAS,GAAG,GAAG;IAC9F,IAAIA,SAAS,GAAGD,MAAM,CAACC,SAAS,GAAG,0BAA0B;IAC7D,IAAID,MAAM,CAACE,YAAY,EAAE;MACvBD,SAAS,GAAGA,SAAS,GAAG,gBAAgB,GAAGD,MAAM,CAACE,YAAY;IAChE;IACA,OAAOC,OAAO,CAACC,OAAO,CAAC,CAAC,CAACV,IAAI,CAAC,MAAM;MAClC,IAAI,CAACM,MAAM,CAACK,SAAS,IAAIL,MAAM,CAACM,MAAM,EAAE;QACtC,OAAO,IAAI,CAACd,UAAU,CAAC,CAAC;MAC1B,CAAC,MAAM;QACL,OAAOQ,MAAM,CAACK,SAAS;MACzB;IACF,CAAC,CAAC,CAACX,IAAI,CAAEa,QAAgB,IAAK;MAC5B,IAAI,CAACA,QAAQ,EAAE;QACb;MACF;MACA,MAAMC,QAA4B,GAAGD,QAAQ,CAACE,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC,IAAI,EAAE;MACpE,MAAMC,GAAQ,GAAGH,QAAQ,CAACC,KAAK,CAAC,GAAG,CAAC;MACpC,MAAMG,aAAqB,GAAG,GAAG,GAAGD,GAAG,CAACA,GAAG,CAACE,MAAM,GAAG,CAAC,CAAC;MACvD,IAAIC,OAAO,GAAG;QACZhB,GAAG,EAAES,QAAQ;QACbjB,IAAI,EAAEJ,qBAAqB,CAAC0B,aAAa,CAAC;QAC1CG,IAAI,EAAEP;MACR,CAAC;MAED,IAAIQ,QAAQ,GAAG,IAAIC,QAAQ,CAAC,CAAC;MAC7BD,QAAQ,CAACE,MAAM,CAAC,OAAO,EAAEJ,OAAO,CAAC;MACjC,OAAOhC,KAAK,CAAC;QACXqC,GAAG,EAAElB,SAAS;QACdmB,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB,CAAC;QACDC,IAAI,EAAEN;MACR,CAAC,CAAC,CAACtB,IAAI,CACJC,QAAQ,IAAK;QACd,OAAOA,QAAQ,CAAC2B,IAAI,CAAC,CAAC,CAAC;MACzB,CAAC,EAAEC,KAAK,IAAIA,KAAK,CAAC;IACpB,CAAC,CAAC;EACJ;AACF"}