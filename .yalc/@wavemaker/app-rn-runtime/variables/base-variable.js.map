{"version":3,"names":["DatasetUtil","EventNotifier","ROOT_LOGGER","isNumber","isObject","isBoolean","get","isEqual","VariableEvents","VARIABLE_LOGGER","extend","BaseVariable","constructor","config","_defineProperty","name","isList","twoWayBinding","dataSet","subscribe","BEFORE_INVOKE","isExecuting","info","AFTER_INVOKE","invoke","params","onSuccess","onError","paramProvider","Promise","resolve","doNext","reject","invokeOnParamChange","last","latest","getData","setData","isValidDataset","getValue","key","index","setValue","value","getItem","setItem","options","getChildDetails","addItem","removeItem","exactMatch","parentIndex","path","clearData","getValidDataset","getCount","pause","resume","destroy"],"sources":["base-variable.ts"],"sourcesContent":["import DatasetUtil from './utils/dataset-util';\nimport EventNotifier from '@wavemaker/app-rn-runtime/core/event-notifier';\nimport { ROOT_LOGGER } from '@wavemaker/app-rn-runtime/core/logger';\nimport { isNumber, isObject, isBoolean, get, isEqual } from 'lodash';\nexport interface VariableConfig {\n    name: string;\n    paramProvider: Function;\n    onBefore: Function;\n    onComplete: Function;\n    onSuccess: Function;\n    onError: Function;\n    isList: boolean;\n    twoWayBinding: boolean;\n    service: any;\n    operation: string;\n    operationId: string;\n    operationType: string;\n    serviceType: string;\n}\n\nexport enum VariableEvents {\n  BEFORE_INVOKE = 'beforeInvoke',\n  SUCCESS = 'success',\n  ERROR = 'error',\n  AFTER_INVOKE = 'afterInvoke'\n};\n\nexport const VARIABLE_LOGGER = ROOT_LOGGER.extend('variable');\n\nexport abstract class BaseVariable<T extends VariableConfig> extends EventNotifier {\n    name: string = '';\n    params: any = {};\n    dataSet: any = {};\n    isList: boolean;\n    twoWayBinding: boolean;\n    isExecuting = false;\n\n    constructor(public config: T) {\n      super();\n      this.name = config.name;\n      this.isList = config.isList;\n      this.twoWayBinding = config.twoWayBinding;\n      this.dataSet = this.isList ? []: this.dataSet;\n      this.subscribe(VariableEvents.BEFORE_INVOKE, () => {\n        this.isExecuting = true;\n        VARIABLE_LOGGER.info(`Before Invoking variable ${this.name}`);\n      });\n      this.subscribe(VariableEvents.AFTER_INVOKE, () => {\n        this.isExecuting = false;\n        VARIABLE_LOGGER.info(`After Invoking variable ${this.name}`);\n      });\n    }\n\n    public invoke(params?: {}, onSuccess?: Function, onError?: Function): Promise<BaseVariable<T>> {\n        if (!params) {\n            this.params = this.config.paramProvider();\n        } else {\n            this.params = params;\n        }\n        return Promise.resolve(this);\n    }\n\n    public doNext(): Promise<BaseVariable<T>> {\n      return Promise.reject(this);\n    }\n\n    public invokeOnParamChange(): Promise<BaseVariable<T>> {\n        const last = this.params;\n        const latest = this.config.paramProvider();\n        if (!isEqual(last, latest)) {\n            return this.invoke(latest);\n        }\n        return Promise.resolve(this);\n    }\n\n    public getData() {\n        return this.dataSet;\n    }\n\n    public setData(dataSet: any) {\n      if (DatasetUtil.isValidDataset(dataSet, this.isList)) {\n        this.dataSet = dataSet;\n      }\n      return this.dataSet;\n    }\n\n    getValue(key: string, index: number) {\n      return DatasetUtil.getValue(this.dataSet, key, index, this.isList);\n    }\n\n    setValue(key: string, value: any) {\n      return DatasetUtil.setValue(this.dataSet, key, value, this.isList);\n    }\n\n    getItem(index: number) {\n      return DatasetUtil.getItem(this.dataSet, index, this.isList);\n    }\n\n    setItem(index: any, value: any, options?: any) {\n      options = DatasetUtil.getChildDetails(this.dataSet, options, this.isList);\n      return DatasetUtil.setItem(this.dataSet, index, value, options);\n    }\n\n    addItem(value: any, options?: any) {\n      let index;\n      if (isNumber(options)) {\n        index = options;\n      }\n      if (isObject(options)) {\n        // @ts-ignore\n        index = options.index;\n      }\n\n      options = DatasetUtil.getChildDetails(this.dataSet, options, this.isList);\n      return DatasetUtil.addItem(this.dataSet, value, index, options);\n    }\n\n    removeItem(index: any, options?: any) {\n      let exactMatch, parentIndex;\n      if (options) {\n        if (isBoolean(options)) {\n          exactMatch = options;\n        }\n        if (isObject(options)) {\n          // @ts-ignore\n          exactMatch = options.exactMatch;\n          if (this.isList) {\n            // @ts-ignore\n            parentIndex = options.parentIndex || 0;\n          }\n        }\n      }\n      return DatasetUtil.removeItem(this.dataSet, index, { exactMatch, path: get(options, 'path'), parentIndex });\n    }\n\n    clearData() {\n      this.dataSet = DatasetUtil.getValidDataset(this.isList);\n      return this.dataSet;\n    }\n\n    getCount() {\n      return DatasetUtil.getCount(this.dataSet, this.isList);\n    }\n\n    pause() {}\n\n    resume() {}\n\n    destroy() {}\n\n}\n"],"mappings":"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"}